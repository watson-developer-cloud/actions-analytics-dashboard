{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // Internal Imports\n\n\nimport { Component } from '../component';\nimport { DOMUtils } from '../../services';\nimport { Tools } from '../../tools';\nimport { CalloutDirections, Roles, Events, Alignments, ColorClassNameTypes } from '../../interfaces';\nimport * as Configuration from '../../configuration'; // D3 Imports\n\nimport { select } from 'd3-selection';\nimport { arc, pie } from 'd3-shape';\nimport { interpolate } from 'd3-interpolate'; // Pie slice tween function\n\nfunction arcTween(a, arcFunc) {\n  var _this = this;\n\n  var i = interpolate(this._current, a);\n  return function (t) {\n    _this._current = i(t);\n    return arcFunc(_this._current);\n  };\n}\n\nvar Pie =\n/** @class */\nfunction (_super) {\n  __extends(Pie, _super);\n\n  function Pie() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = 'pie'; // Highlight elements that match the hovered legend item\n\n    _this.handleLegendOnHover = function (event) {\n      var hoveredElement = event.detail.hoveredElement;\n\n      var groupMapsTo = _this.getOptions().data.groupMapsTo;\n\n      _this.parent.selectAll('path.slice').transition(_this.services.transitions.getTransition('legend-hover-bar')).attr('opacity', function (d) {\n        return d.data[groupMapsTo] !== hoveredElement.datum()['name'] ? 0.3 : 1;\n      });\n    }; // Un-highlight all elements\n\n\n    _this.handleLegendMouseOut = function (event) {\n      _this.parent.selectAll('path.slice').transition(_this.services.transitions.getTransition('legend-mouseout-bar')).attr('opacity', 1);\n    };\n\n    return _this;\n  }\n\n  Pie.prototype.init = function () {\n    var eventsFragment = this.services.events; // Highlight correct circle on legend item hovers\n\n    eventsFragment.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover); // Un-highlight circles on legend item mouseouts\n\n    eventsFragment.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n  };\n\n  Pie.prototype.getInnerRadius = function () {\n    return Configuration.pie.innerRadius;\n  };\n\n  Pie.prototype.render = function (animate) {\n    var _this = this;\n\n    if (animate === void 0) {\n      animate = true;\n    }\n\n    var self = this;\n    var svg = this.getContainerSVG(); // remove any slices that are valued at 0 because they dont need to be rendered and will create extra padding\n\n    var displayData = this.model.getDisplayData().filter(function (data) {\n      return data.value > 0;\n    });\n    var options = this.getOptions();\n    var groupMapsTo = options.data.groupMapsTo; // Compute the outer radius needed\n\n    var radius = this.computeRadius();\n    this.arc = arc().innerRadius(this.getInnerRadius()).outerRadius(radius); // Set the hover arc radius\n\n    this.hoverArc = arc().innerRadius(this.getInnerRadius()).outerRadius(radius + Configuration.pie.hoverArc.outerRadiusOffset); // Setup the pie layout\n\n    var pieLayout = pie().value(function (d) {\n      return d.value;\n    }).sort(null).padAngle(Configuration.pie.padAngle); // Sort pie layout data based off of the indecies the layout creates\n\n    var pieLayoutData = pieLayout(displayData).sort(function (a, b) {\n      return a.index - b.index;\n    }); // Update data on all slices\n\n    var slicesGroup = DOMUtils.appendOrSelect(svg, 'g.slices').attr('role', Roles.GROUP).attr('data-name', 'slices');\n    var paths = slicesGroup.selectAll('path.slice').data(pieLayoutData, function (d) {\n      return d.data[groupMapsTo];\n    }); // Remove slices that need to be exited\n\n    paths.exit().attr('opacity', 0).remove(); // Add new slices that are being introduced\n\n    var enteringPaths = paths.enter().append('path').classed('slice', true).attr('opacity', 0); // Update styles & position on existing and entering slices\n\n    enteringPaths.merge(paths).attr('class', function (d) {\n      return _this.model.getColorClassName({\n        classNameTypes: [ColorClassNameTypes.FILL],\n        dataGroupName: d.data[groupMapsTo],\n        originalClassName: 'slice'\n      });\n    }).style('fill', function (d) {\n      return self.model.getFillColor(d.data[groupMapsTo]);\n    }).attr('d', this.arc).transition(this.services.transitions.getTransition('pie-slice-enter-update', animate)).attr('opacity', 1) // a11y\n    .attr('role', Roles.GRAPHICS_SYMBOL).attr('aria-roledescription', 'slice').attr('aria-label', function (d) {\n      return d.value + \", \" + (Tools.convertValueToPercentage(d.data.value, displayData) + '%');\n    }) // Tween\n    .attrTween('d', function (a) {\n      return arcTween.bind(this)(a, self.arc);\n    }); // Draw the slice labels\n\n    var renderLabels = options.pie.labels.enabled;\n    var labelData = renderLabels ? pieLayoutData.filter(function (x) {\n      return x.value > 0;\n    }) : [];\n    var labelsGroup = DOMUtils.appendOrSelect(svg, 'g.labels').attr('role', Roles.GROUP).attr('data-name', 'labels');\n    var labels = labelsGroup.selectAll('text.pie-label').data(labelData, function (d) {\n      return d.data[groupMapsTo];\n    }); // Remove labels that are existing\n\n    labels.exit().attr('opacity', 0).remove(); // Add labels that are being introduced\n\n    var enteringLabels = labels.enter().append('text').classed('pie-label', true); // Update styles & position on existing & entering labels\n\n    var calloutData = [];\n    enteringLabels.merge(labels).style('text-anchor', 'middle').text(function (d) {\n      if (options.pie.labels.formatter) {\n        return options.pie.labels.formatter(d);\n      }\n\n      return Tools.convertValueToPercentage(d.data.value, displayData) + '%';\n    }) // Calculate dimensions in order to transform\n    .datum(function (d) {\n      var marginedRadius = radius + 7;\n      var theta = (d.endAngle - d.startAngle) / 2 + d.startAngle;\n      var deg = theta / Math.PI * 180;\n      var textLength = this.getComputedTextLength();\n      d.textOffsetX = textLength / 2;\n      d.textOffsetY = deg > 90 && deg < 270 ? 10 : 0;\n      d.xPosition = (d.textOffsetX + marginedRadius) * Math.sin(theta);\n      d.yPosition = (d.textOffsetY + marginedRadius) * -Math.cos(theta);\n      return d;\n    }).attr('transform', function (d, i) {\n      var totalSlices = labelData.length;\n      var sliceAngleDeg = (d.endAngle - d.startAngle) * (180 / Math.PI); // check if last 2 slices (or just last) are < the threshold\n\n      if (i >= totalSlices - 2) {\n        if (sliceAngleDeg < Configuration.pie.callout.minSliceDegree) {\n          var labelTranslateX = void 0,\n              labelTranslateY = void 0;\n\n          if (d.index === totalSlices - 1) {\n            labelTranslateX = d.xPosition + Configuration.pie.callout.offsetX + Configuration.pie.callout.textMargin + d.textOffsetX;\n            labelTranslateY = d.yPosition - Configuration.pie.callout.offsetY; // Set direction of callout\n\n            d.direction = CalloutDirections.RIGHT;\n            calloutData.push(d);\n          } else {\n            labelTranslateX = d.xPosition - Configuration.pie.callout.offsetX - d.textOffsetX - Configuration.pie.callout.textMargin;\n            labelTranslateY = d.yPosition - Configuration.pie.callout.offsetY; // Set direction of callout\n\n            d.direction = CalloutDirections.LEFT;\n            calloutData.push(d);\n          }\n\n          return \"translate(\" + labelTranslateX + \", \" + labelTranslateY + \")\";\n        }\n      }\n\n      return \"translate(\" + d.xPosition + \", \" + d.yPosition + \")\";\n    }); // Render pie label callouts\n\n    this.renderCallouts(calloutData);\n    var optionName = Tools.getProperty(options, 'donut') ? 'donut' : 'pie';\n    var alignment = Tools.getProperty(options, optionName, 'alignment');\n    var width = DOMUtils.getSVGElementSize(this.getParent(), {\n      useAttr: true\n    }).width; // don't add padding for labels & callouts if they are disabled\n\n    var xOffset = renderLabels ? Configuration.pie.xOffset : 0;\n    var yOffset = renderLabels ? Configuration.pie.yOffset : 0; // Position Pie\n\n    var pieTranslateX = radius + xOffset;\n\n    if (alignment === Alignments.CENTER) {\n      pieTranslateX = width / 2;\n    } else if (alignment === Alignments.RIGHT) {\n      pieTranslateX = width - radius - Configuration.pie.xOffset;\n    }\n\n    var pieTranslateY = radius + yOffset;\n\n    if (calloutData.length > 0) {\n      pieTranslateY += Configuration.pie.yOffsetCallout;\n    }\n\n    svg.attr('transform', \"translate(\" + pieTranslateX + \", \" + pieTranslateY + \")\"); // Add event listeners\n\n    this.addEventListeners();\n  };\n\n  Pie.prototype.renderCallouts = function (calloutData) {\n    var svg = DOMUtils.appendOrSelect(this.getContainerSVG(), 'g.callouts').attr('role', Roles.GROUP).attr('data-name', 'callouts'); // Update data on callouts\n\n    var callouts = svg.selectAll('g.callout').data(calloutData);\n    callouts.exit().remove();\n    var enteringCallouts = callouts.enter().append('g').classed('callout', true) // a11y\n    .attr('role', Roles.GRAPHICS_SYMBOL + \" \" + Roles.GROUP).attr('aria-roledescription', 'label callout'); // Update data values for each callout\n    // For the horizontal and vertical lines to use\n\n    enteringCallouts.merge(callouts).datum(function (d) {\n      var xPosition = d.xPosition,\n          yPosition = d.yPosition,\n          direction = d.direction;\n\n      if (direction === CalloutDirections.RIGHT) {\n        d.startPos = {\n          x: xPosition,\n          y: yPosition + d.textOffsetY\n        }; // end position for the callout line\n\n        d.endPos = {\n          x: xPosition + Configuration.pie.callout.offsetX,\n          y: yPosition - Configuration.pie.callout.offsetY + d.textOffsetY\n        }; // the intersection point of the vertical and horizontal line\n\n        d.intersectPointX = d.endPos.x - Configuration.pie.callout.horizontalLineLength;\n      } else {\n        // start position for the callout line\n        d.startPos = {\n          x: xPosition,\n          y: yPosition + d.textOffsetY\n        }; // end position for the callout line should be bottom aligned to the title\n\n        d.endPos = {\n          x: xPosition - Configuration.pie.callout.offsetX,\n          y: yPosition - Configuration.pie.callout.offsetY + d.textOffsetY\n        }; // the intersection point of the vertical and horizontal line\n\n        d.intersectPointX = d.endPos.x + Configuration.pie.callout.horizontalLineLength;\n      } // Store the necessary data in the DOM element\n\n\n      return d;\n    }); // draw vertical line\n\n    var enteringVerticalLines = enteringCallouts.append('line').classed('vertical-line', true);\n    enteringVerticalLines.merge(svg.selectAll('line.vertical-line')).datum(function (d) {\n      return select(this.parentNode).datum();\n    }).style('stroke-width', '1px').attr('x1', function (d) {\n      return d.startPos.x;\n    }).attr('y1', function (d) {\n      return d.startPos.y;\n    }).attr('x2', function (d) {\n      return d.intersectPointX;\n    }).attr('y2', function (d) {\n      return d.endPos.y;\n    }); // draw horizontal line\n\n    var enteringHorizontalLines = enteringCallouts.append('line').classed('horizontal-line', true);\n    enteringHorizontalLines.merge(svg.selectAll('line.horizontal-line')).datum(function (d) {\n      return select(this.parentNode).datum();\n    }).style('stroke-width', '1px').attr('x1', function (d) {\n      return d.intersectPointX;\n    }).attr('y1', function (d) {\n      return d.endPos.y;\n    }).attr('x2', function (d) {\n      return d.endPos.x;\n    }).attr('y2', function (d) {\n      return d.endPos.y;\n    });\n  };\n\n  Pie.prototype.addEventListeners = function () {\n    var self = this;\n    this.parent.selectAll('path.slice').on('mouseover', function (datum) {\n      var hoveredElement = select(this);\n      hoveredElement.classed('hovered', true).transition(self.services.transitions.getTransition('pie_slice_mouseover')).attr('d', self.hoverArc); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEOVER, {\n        element: select(this),\n        datum: datum\n      });\n      var groupMapsTo = self.getOptions().data.groupMapsTo; // Show tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n        hoveredElement: hoveredElement,\n        items: [{\n          label: datum.data[groupMapsTo],\n          value: datum.data.value\n        }]\n      });\n    }).on('mousemove', function (datum) {\n      var hoveredElement = select(this); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEMOVE, {\n        element: hoveredElement,\n        datum: datum\n      }); // Show tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n    }).on('click', function (datum) {\n      // Dispatch mouse event\n      self.services.events.dispatchEvent(Events.Pie.SLICE_CLICK, {\n        element: select(this),\n        datum: datum\n      });\n    }).on('mouseout', function (datum) {\n      var hoveredElement = select(this);\n      hoveredElement.classed('hovered', false).transition(self.services.transitions.getTransition('pie_slice_mouseover')).attr('d', self.arc); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEOUT, {\n        element: hoveredElement,\n        datum: datum\n      }); // Hide tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n        hoveredElement: hoveredElement\n      });\n    });\n  }; // Helper functions\n\n\n  Pie.prototype.computeRadius = function () {\n    var _a = DOMUtils.getSVGElementSize(this.parent, {\n      useAttrs: true\n    }),\n        width = _a.width,\n        height = _a.height;\n\n    var options = this.getOptions();\n    var radius = Math.min(width, height) / 2;\n    var renderLabels = options.pie.labels.enabled;\n    return renderLabels ? radius + Configuration.pie.radiusOffset : radius;\n  };\n\n  return Pie;\n}(Component);\n\nexport { Pie };","map":{"version":3,"sources":["/Users/zander/Documents/Development/ActionsLogging/Dashboard/node_modules/@carbon/charts/components/graphs/pie.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Component","DOMUtils","Tools","CalloutDirections","Roles","Events","Alignments","ColorClassNameTypes","Configuration","select","arc","pie","interpolate","arcTween","a","arcFunc","_this","i","_current","t","Pie","_super","apply","arguments","type","handleLegendOnHover","event","hoveredElement","detail","groupMapsTo","getOptions","data","parent","selectAll","transition","services","transitions","getTransition","attr","datum","handleLegendMouseOut","init","eventsFragment","events","addEventListener","Legend","ITEM_HOVER","ITEM_MOUSEOUT","getInnerRadius","innerRadius","render","animate","self","svg","getContainerSVG","displayData","model","getDisplayData","filter","value","options","radius","computeRadius","outerRadius","hoverArc","outerRadiusOffset","pieLayout","sort","padAngle","pieLayoutData","index","slicesGroup","appendOrSelect","GROUP","paths","exit","remove","enteringPaths","enter","append","classed","merge","getColorClassName","classNameTypes","FILL","dataGroupName","originalClassName","style","getFillColor","GRAPHICS_SYMBOL","convertValueToPercentage","attrTween","bind","renderLabels","labels","enabled","labelData","x","labelsGroup","enteringLabels","calloutData","text","formatter","marginedRadius","theta","endAngle","startAngle","deg","Math","PI","textLength","getComputedTextLength","textOffsetX","textOffsetY","xPosition","sin","yPosition","cos","totalSlices","length","sliceAngleDeg","callout","minSliceDegree","labelTranslateX","labelTranslateY","offsetX","textMargin","offsetY","direction","RIGHT","push","LEFT","renderCallouts","optionName","getProperty","alignment","width","getSVGElementSize","getParent","useAttr","xOffset","yOffset","pieTranslateX","CENTER","pieTranslateY","yOffsetCallout","addEventListeners","callouts","enteringCallouts","startPos","y","endPos","intersectPointX","horizontalLineLength","enteringVerticalLines","parentNode","enteringHorizontalLines","on","dispatchEvent","SLICE_MOUSEOVER","element","Tooltip","SHOW","items","label","SLICE_MOUSEMOVE","MOVE","SLICE_CLICK","SLICE_MOUSEOUT","HIDE","_a","useAttrs","height","min","radiusOffset"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// Internal Imports\nimport { Component } from '../component';\nimport { DOMUtils } from '../../services';\nimport { Tools } from '../../tools';\nimport { CalloutDirections, Roles, Events, Alignments, ColorClassNameTypes, } from '../../interfaces';\nimport * as Configuration from '../../configuration';\n// D3 Imports\nimport { select } from 'd3-selection';\nimport { arc, pie } from 'd3-shape';\nimport { interpolate } from 'd3-interpolate';\n// Pie slice tween function\nfunction arcTween(a, arcFunc) {\n    var _this = this;\n    var i = interpolate(this._current, a);\n    return function (t) {\n        _this._current = i(t);\n        return arcFunc(_this._current);\n    };\n}\nvar Pie = /** @class */ (function (_super) {\n    __extends(Pie, _super);\n    function Pie() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.type = 'pie';\n        // Highlight elements that match the hovered legend item\n        _this.handleLegendOnHover = function (event) {\n            var hoveredElement = event.detail.hoveredElement;\n            var groupMapsTo = _this.getOptions().data.groupMapsTo;\n            _this.parent\n                .selectAll('path.slice')\n                .transition(_this.services.transitions.getTransition('legend-hover-bar'))\n                .attr('opacity', function (d) {\n                return d.data[groupMapsTo] !== hoveredElement.datum()['name'] ? 0.3 : 1;\n            });\n        };\n        // Un-highlight all elements\n        _this.handleLegendMouseOut = function (event) {\n            _this.parent\n                .selectAll('path.slice')\n                .transition(_this.services.transitions.getTransition('legend-mouseout-bar'))\n                .attr('opacity', 1);\n        };\n        return _this;\n    }\n    Pie.prototype.init = function () {\n        var eventsFragment = this.services.events;\n        // Highlight correct circle on legend item hovers\n        eventsFragment.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover);\n        // Un-highlight circles on legend item mouseouts\n        eventsFragment.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n    };\n    Pie.prototype.getInnerRadius = function () {\n        return Configuration.pie.innerRadius;\n    };\n    Pie.prototype.render = function (animate) {\n        var _this = this;\n        if (animate === void 0) { animate = true; }\n        var self = this;\n        var svg = this.getContainerSVG();\n        // remove any slices that are valued at 0 because they dont need to be rendered and will create extra padding\n        var displayData = this.model\n            .getDisplayData()\n            .filter(function (data) { return data.value > 0; });\n        var options = this.getOptions();\n        var groupMapsTo = options.data.groupMapsTo;\n        // Compute the outer radius needed\n        var radius = this.computeRadius();\n        this.arc = arc().innerRadius(this.getInnerRadius()).outerRadius(radius);\n        // Set the hover arc radius\n        this.hoverArc = arc()\n            .innerRadius(this.getInnerRadius())\n            .outerRadius(radius + Configuration.pie.hoverArc.outerRadiusOffset);\n        // Setup the pie layout\n        var pieLayout = pie()\n            .value(function (d) { return d.value; })\n            .sort(null)\n            .padAngle(Configuration.pie.padAngle);\n        // Sort pie layout data based off of the indecies the layout creates\n        var pieLayoutData = pieLayout(displayData).sort(function (a, b) { return a.index - b.index; });\n        // Update data on all slices\n        var slicesGroup = DOMUtils.appendOrSelect(svg, 'g.slices')\n            .attr('role', Roles.GROUP)\n            .attr('data-name', 'slices');\n        var paths = slicesGroup\n            .selectAll('path.slice')\n            .data(pieLayoutData, function (d) { return d.data[groupMapsTo]; });\n        // Remove slices that need to be exited\n        paths.exit().attr('opacity', 0).remove();\n        // Add new slices that are being introduced\n        var enteringPaths = paths\n            .enter()\n            .append('path')\n            .classed('slice', true)\n            .attr('opacity', 0);\n        // Update styles & position on existing and entering slices\n        enteringPaths\n            .merge(paths)\n            .attr('class', function (d) {\n            return _this.model.getColorClassName({\n                classNameTypes: [ColorClassNameTypes.FILL],\n                dataGroupName: d.data[groupMapsTo],\n                originalClassName: 'slice',\n            });\n        })\n            .style('fill', function (d) { return self.model.getFillColor(d.data[groupMapsTo]); })\n            .attr('d', this.arc)\n            .transition(this.services.transitions.getTransition('pie-slice-enter-update', animate))\n            .attr('opacity', 1)\n            // a11y\n            .attr('role', Roles.GRAPHICS_SYMBOL)\n            .attr('aria-roledescription', 'slice')\n            .attr('aria-label', function (d) {\n            return d.value + \", \" + (Tools.convertValueToPercentage(d.data.value, displayData) + '%');\n        })\n            // Tween\n            .attrTween('d', function (a) {\n            return arcTween.bind(this)(a, self.arc);\n        });\n        // Draw the slice labels\n        var renderLabels = options.pie.labels.enabled;\n        var labelData = renderLabels\n            ? pieLayoutData.filter(function (x) { return x.value > 0; })\n            : [];\n        var labelsGroup = DOMUtils.appendOrSelect(svg, 'g.labels')\n            .attr('role', Roles.GROUP)\n            .attr('data-name', 'labels');\n        var labels = labelsGroup\n            .selectAll('text.pie-label')\n            .data(labelData, function (d) { return d.data[groupMapsTo]; });\n        // Remove labels that are existing\n        labels.exit().attr('opacity', 0).remove();\n        // Add labels that are being introduced\n        var enteringLabels = labels\n            .enter()\n            .append('text')\n            .classed('pie-label', true);\n        // Update styles & position on existing & entering labels\n        var calloutData = [];\n        enteringLabels\n            .merge(labels)\n            .style('text-anchor', 'middle')\n            .text(function (d) {\n            if (options.pie.labels.formatter) {\n                return options.pie.labels.formatter(d);\n            }\n            return (Tools.convertValueToPercentage(d.data.value, displayData) +\n                '%');\n        })\n            // Calculate dimensions in order to transform\n            .datum(function (d) {\n            var marginedRadius = radius + 7;\n            var theta = (d.endAngle - d.startAngle) / 2 + d.startAngle;\n            var deg = (theta / Math.PI) * 180;\n            var textLength = this.getComputedTextLength();\n            d.textOffsetX = textLength / 2;\n            d.textOffsetY = deg > 90 && deg < 270 ? 10 : 0;\n            d.xPosition =\n                (d.textOffsetX + marginedRadius) * Math.sin(theta);\n            d.yPosition =\n                (d.textOffsetY + marginedRadius) * -Math.cos(theta);\n            return d;\n        })\n            .attr('transform', function (d, i) {\n            var totalSlices = labelData.length;\n            var sliceAngleDeg = (d.endAngle - d.startAngle) * (180 / Math.PI);\n            // check if last 2 slices (or just last) are < the threshold\n            if (i >= totalSlices - 2) {\n                if (sliceAngleDeg < Configuration.pie.callout.minSliceDegree) {\n                    var labelTranslateX = void 0, labelTranslateY = void 0;\n                    if (d.index === totalSlices - 1) {\n                        labelTranslateX =\n                            d.xPosition +\n                                Configuration.pie.callout.offsetX +\n                                Configuration.pie.callout.textMargin +\n                                d.textOffsetX;\n                        labelTranslateY =\n                            d.yPosition - Configuration.pie.callout.offsetY;\n                        // Set direction of callout\n                        d.direction = CalloutDirections.RIGHT;\n                        calloutData.push(d);\n                    }\n                    else {\n                        labelTranslateX =\n                            d.xPosition -\n                                Configuration.pie.callout.offsetX -\n                                d.textOffsetX -\n                                Configuration.pie.callout.textMargin;\n                        labelTranslateY =\n                            d.yPosition - Configuration.pie.callout.offsetY;\n                        // Set direction of callout\n                        d.direction = CalloutDirections.LEFT;\n                        calloutData.push(d);\n                    }\n                    return \"translate(\" + labelTranslateX + \", \" + labelTranslateY + \")\";\n                }\n            }\n            return \"translate(\" + d.xPosition + \", \" + d.yPosition + \")\";\n        });\n        // Render pie label callouts\n        this.renderCallouts(calloutData);\n        var optionName = Tools.getProperty(options, 'donut')\n            ? 'donut'\n            : 'pie';\n        var alignment = Tools.getProperty(options, optionName, 'alignment');\n        var width = DOMUtils.getSVGElementSize(this.getParent(), {\n            useAttr: true,\n        }).width;\n        // don't add padding for labels & callouts if they are disabled\n        var xOffset = renderLabels ? Configuration.pie.xOffset : 0;\n        var yOffset = renderLabels ? Configuration.pie.yOffset : 0;\n        // Position Pie\n        var pieTranslateX = radius + xOffset;\n        if (alignment === Alignments.CENTER) {\n            pieTranslateX = width / 2;\n        }\n        else if (alignment === Alignments.RIGHT) {\n            pieTranslateX = width - radius - Configuration.pie.xOffset;\n        }\n        var pieTranslateY = radius + yOffset;\n        if (calloutData.length > 0) {\n            pieTranslateY += Configuration.pie.yOffsetCallout;\n        }\n        svg.attr('transform', \"translate(\" + pieTranslateX + \", \" + pieTranslateY + \")\");\n        // Add event listeners\n        this.addEventListeners();\n    };\n    Pie.prototype.renderCallouts = function (calloutData) {\n        var svg = DOMUtils.appendOrSelect(this.getContainerSVG(), 'g.callouts')\n            .attr('role', Roles.GROUP)\n            .attr('data-name', 'callouts');\n        // Update data on callouts\n        var callouts = svg.selectAll('g.callout').data(calloutData);\n        callouts.exit().remove();\n        var enteringCallouts = callouts\n            .enter()\n            .append('g')\n            .classed('callout', true)\n            // a11y\n            .attr('role', Roles.GRAPHICS_SYMBOL + \" \" + Roles.GROUP)\n            .attr('aria-roledescription', 'label callout');\n        // Update data values for each callout\n        // For the horizontal and vertical lines to use\n        enteringCallouts.merge(callouts).datum(function (d) {\n            var xPosition = d.xPosition, yPosition = d.yPosition, direction = d.direction;\n            if (direction === CalloutDirections.RIGHT) {\n                d.startPos = {\n                    x: xPosition,\n                    y: yPosition + d.textOffsetY,\n                };\n                // end position for the callout line\n                d.endPos = {\n                    x: xPosition + Configuration.pie.callout.offsetX,\n                    y: yPosition -\n                        Configuration.pie.callout.offsetY +\n                        d.textOffsetY,\n                };\n                // the intersection point of the vertical and horizontal line\n                d.intersectPointX =\n                    d.endPos.x - Configuration.pie.callout.horizontalLineLength;\n            }\n            else {\n                // start position for the callout line\n                d.startPos = {\n                    x: xPosition,\n                    y: yPosition + d.textOffsetY,\n                };\n                // end position for the callout line should be bottom aligned to the title\n                d.endPos = {\n                    x: xPosition - Configuration.pie.callout.offsetX,\n                    y: yPosition -\n                        Configuration.pie.callout.offsetY +\n                        d.textOffsetY,\n                };\n                // the intersection point of the vertical and horizontal line\n                d.intersectPointX =\n                    d.endPos.x + Configuration.pie.callout.horizontalLineLength;\n            }\n            // Store the necessary data in the DOM element\n            return d;\n        });\n        // draw vertical line\n        var enteringVerticalLines = enteringCallouts\n            .append('line')\n            .classed('vertical-line', true);\n        enteringVerticalLines\n            .merge(svg.selectAll('line.vertical-line'))\n            .datum(function (d) {\n            return select(this.parentNode).datum();\n        })\n            .style('stroke-width', '1px')\n            .attr('x1', function (d) { return d.startPos.x; })\n            .attr('y1', function (d) { return d.startPos.y; })\n            .attr('x2', function (d) { return d.intersectPointX; })\n            .attr('y2', function (d) { return d.endPos.y; });\n        // draw horizontal line\n        var enteringHorizontalLines = enteringCallouts\n            .append('line')\n            .classed('horizontal-line', true);\n        enteringHorizontalLines\n            .merge(svg.selectAll('line.horizontal-line'))\n            .datum(function (d) {\n            return select(this.parentNode).datum();\n        })\n            .style('stroke-width', '1px')\n            .attr('x1', function (d) { return d.intersectPointX; })\n            .attr('y1', function (d) { return d.endPos.y; })\n            .attr('x2', function (d) { return d.endPos.x; })\n            .attr('y2', function (d) { return d.endPos.y; });\n    };\n    Pie.prototype.addEventListeners = function () {\n        var self = this;\n        this.parent\n            .selectAll('path.slice')\n            .on('mouseover', function (datum) {\n            var hoveredElement = select(this);\n            hoveredElement\n                .classed('hovered', true)\n                .transition(self.services.transitions.getTransition('pie_slice_mouseover'))\n                .attr('d', self.hoverArc);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEOVER, {\n                element: select(this),\n                datum: datum,\n            });\n            var groupMapsTo = self.getOptions().data.groupMapsTo;\n            // Show tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n                hoveredElement: hoveredElement,\n                items: [\n                    {\n                        label: datum.data[groupMapsTo],\n                        value: datum.data.value,\n                    },\n                ],\n            });\n        })\n            .on('mousemove', function (datum) {\n            var hoveredElement = select(this);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEMOVE, {\n                element: hoveredElement,\n                datum: datum,\n            });\n            // Show tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n        })\n            .on('click', function (datum) {\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Pie.SLICE_CLICK, {\n                element: select(this),\n                datum: datum,\n            });\n        })\n            .on('mouseout', function (datum) {\n            var hoveredElement = select(this);\n            hoveredElement\n                .classed('hovered', false)\n                .transition(self.services.transitions.getTransition('pie_slice_mouseover'))\n                .attr('d', self.arc);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEOUT, {\n                element: hoveredElement,\n                datum: datum,\n            });\n            // Hide tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n                hoveredElement: hoveredElement,\n            });\n        });\n    };\n    // Helper functions\n    Pie.prototype.computeRadius = function () {\n        var _a = DOMUtils.getSVGElementSize(this.parent, {\n            useAttrs: true,\n        }), width = _a.width, height = _a.height;\n        var options = this.getOptions();\n        var radius = Math.min(width, height) / 2;\n        var renderLabels = options.pie.labels.enabled;\n        return renderLabels ? radius + Configuration.pie.radiusOffset : radius;\n    };\n    return Pie;\n}(Component));\nexport { Pie };\n//# sourceMappingURL=../../../src/components/graphs/pie.js.map"]},"metadata":{},"sourceType":"module"}