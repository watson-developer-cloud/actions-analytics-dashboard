{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {\n    s += arguments[i].length;\n  }\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) {\n    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {\n      r[k] = a[j];\n    }\n  }\n\n  return r;\n}; // Internal Imports\n\n\nimport { Component } from '../component';\nimport { DOMUtils } from '../../services';\nimport * as Configuration from '../../configuration'; // D3 Imports\n\nimport { hierarchy as d3Hierarchy, pack as D3Pack } from 'd3-hierarchy';\nimport { event, select } from 'd3-selection';\nimport { ColorClassNameTypes, Events } from '../../interfaces/enums';\nimport { Tools } from './../../tools';\n\nvar CirclePack =\n/** @class */\nfunction (_super) {\n  __extends(CirclePack, _super);\n\n  function CirclePack() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = 'circle-pack';\n\n    _this.handleLegendOnHover = function (event) {\n      var hoveredElement = event.detail.hoveredElement;\n\n      _this.parent.selectAll('circle.node').transition(_this.services.transitions.getTransition('legend-hover-circlepack')).attr('opacity', function (d) {\n        return d.data.dataGroupName === hoveredElement.datum()['name'] ? 1 : Configuration.circlePack.circles.fillOpacity;\n      });\n    };\n\n    _this.handleLegendMouseOut = function (event) {\n      _this.parent.selectAll('circle.node').transition(_this.services.transitions.getTransition('legend-mouseout-circlepack')).attr('opacity', 1);\n    };\n\n    return _this;\n  }\n\n  CirclePack.prototype.render = function (animate) {\n    var _this = this;\n\n    if (animate === void 0) {\n      animate = true;\n    } // svg and container widths\n\n\n    var svg = this.getContainerSVG({\n      withinChartClip: true\n    });\n\n    var _a = DOMUtils.getSVGElementSize(this.parent, {\n      useAttrs: true\n    }),\n        width = _a.width,\n        height = _a.height;\n\n    if (width === 0 || height === 0) {\n      // on first render the svg is width and height 0\n      // the circle packing layout functionality will not run\n      return;\n    } // data and options (zoom/not zoom)\n\n\n    var displayData = this.model.getDisplayData(); // check if there is just one parent for the data\n\n    var parentNode = this.model.hasParentNode();\n    var hierarchyLevel = this.model.getHierarchyLevel();\n    var options = this.getOptions();\n    var canvasZoomEnabled = Tools.getProperty(options, 'canvasZoom', 'enabled'); // check if there is one root for the data\n    // that root will be the only datagroup (colorscale will be monochrome)\n\n    if (parentNode && Tools.getProperty(displayData, 0, 'children')) {\n      // remove want to remove the parent from being rendered\n      displayData = Tools.getProperty(displayData, 0, 'children');\n    }\n\n    var root = d3Hierarchy({\n      children: displayData\n    }).sum(function (d) {\n      return d.value;\n    }).sort(function (a, b) {\n      return b.value - a.value;\n    });\n    var packLayout = D3Pack().size([width, height]).padding(function (d) {\n      // add 3 px to account for the stroke width 1.5px\n      return d.depth >= 1 ? Configuration.circlePack.padding.children + 3 : Configuration.circlePack.padding.mainGroup + 3;\n    });\n    var nodeData = packLayout(root).descendants().splice(1).filter(function (node) {\n      // filter based on hierarchy level\n      return node.depth <= hierarchyLevel;\n    }); // enter the circles\n\n    var circles = svg.selectAll('circle.node').data(nodeData);\n    circles.exit().attr('width', 0).attr('height', 0).remove();\n    var enteringCircles = circles.enter().append('circle').classed('node', true);\n    enteringCircles.merge(circles).attr('class', function (d) {\n      var originalClass = canvasZoomEnabled && hierarchyLevel === 3 ? _this.getZoomClass(d) : '';\n      return _this.model.getColorClassName({\n        classNameTypes: [ColorClassNameTypes.FILL, ColorClassNameTypes.STROKE],\n        dataGroupName: d.data.dataGroupName,\n        originalClassName: d.children ? \"node \" + originalClass : \"node node-leaf \" + originalClass\n      });\n    }).attr('cx', function (d) {\n      return d.x;\n    }).attr('cy', function (d) {\n      return d.y;\n    }).transition(this.services.transitions.getTransition('circlepack-leaf-update-enter', animate)).attr('r', function (d) {\n      return d.r;\n    }).attr('opacity', 1).attr('fill-opacity', Configuration.circlePack.circles.fillOpacity);\n\n    if (canvasZoomEnabled === true && this.focal) {\n      this.services.canvasZoom.zoomIn(this.focal, enteringCircles, Configuration.canvasZoomSettings);\n      this.setBackgroundListeners();\n    }\n\n    if (!parentNode) {\n      // add legend filtering if it isnt a monochrome chart\n      this.addLegendListeners();\n    } // Add event listeners to elements drawn\n\n\n    this.addEventListeners();\n  }; // turn off the highlight class on children circles\n\n\n  CirclePack.prototype.unhighlightChildren = function (childData) {\n    var data = childData.map(function (d) {\n      return d.data;\n    });\n    this.parent.selectAll('circle.node').filter(function (d) {\n      return data.some(function (datum) {\n        return datum === d.data;\n      }) && d.depth > 1;\n    }).classed('hovered-child', false);\n  }; // highlight the children circles with a stroke\n\n\n  CirclePack.prototype.highlightChildren = function (childData, classname) {\n    var data = childData.map(function (d) {\n      return d.data;\n    });\n    this.parent.selectAll('circle.node').filter(function (d) {\n      return data.some(function (datum) {\n        return datum === d.data;\n      }) && d.depth > 1;\n    }).classed(classname ? classname : 'hovered-child', true);\n  };\n\n  CirclePack.prototype.getZoomClass = function (node) {\n    if (this.model.getHierarchyLevel() === 3 && this.focal) {\n      if (node.data === this.focal.data || this.focal.children.some(function (d) {\n        return d.data === node.data;\n      })) {\n        return 'focal';\n      }\n    }\n\n    return 'non-focal';\n  };\n\n  CirclePack.prototype.addLegendListeners = function () {\n    var events = this.services.events; // Highlight correct circle on legend item hovers\n\n    events.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover); // Un-highlight circles on legend item mouseouts\n\n    events.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n  };\n\n  CirclePack.prototype.removeBackgroundListeners = function () {\n    var chartSvg = select(this.services.domUtils.getMainSVG());\n    chartSvg.on('click', function () {\n      return null;\n    });\n  };\n\n  CirclePack.prototype.setBackgroundListeners = function () {\n    var chartSvg = select(this.services.domUtils.getMainSVG());\n    var self = this;\n    var canvasSelection = this.parent.selectAll('circle.node');\n    var zoomSetting = Tools.getProperty(Configuration, 'canvasZoomSettings');\n    chartSvg.on('click', function () {\n      self.focal = null;\n      self.model.updateHierarchyLevel(2);\n      chartSvg.classed('zoomed-in', false);\n      self.services.canvasZoom.zoomOut(canvasSelection, zoomSetting);\n    });\n  }; // Zoom icon to be appended to the label in the tooltip\n\n\n  CirclePack.prototype.getZoomIcon = function () {\n    return \"\\n\\t\\t<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 10 10\\\">\\n\\t\\t\\t<polygon points=\\\"5.93 3.71 4.45 3.71 4.45 2.23 3.71 2.23 3.71 3.71 2.23 3.71 2.23 4.45 3.71 4.45 3.71 5.93 4.45 5.93 4.45 4.45 5.93 4.45 5.93 3.71\\\"/>\\n\\t\\t\\t<path d=\\\"M7.2,6.67a4,4,0,0,0,1-2.59A4.08,4.08,0,1,0,4.07,8.15h0a4,4,0,0,0,2.59-1L9.48,10,10,9.48Zm-3.12.77A3.34,3.34,0,1,1,7.41,4.08,3.34,3.34,0,0,1,4.08,7.44Z\\\"/>\\n\\t\\t</svg>\";\n  }; // add event listeners for tooltip on the circles\n\n\n  CirclePack.prototype.addEventListeners = function () {\n    var self = this;\n    this.parent.selectAll('circle.node').on('mouseover', function (datum) {\n      var hoveredElement = select(this);\n      hoveredElement.classed('hovered', true);\n      var hierarchyLevel = self.model.getHierarchyLevel();\n      var disabled = hierarchyLevel > 2 && !hoveredElement.classed('focal');\n      var canvasZoomEnabled = Tools.getProperty(self.model.getOptions(), 'canvasZoom', 'enabled');\n      var zoomable = false;\n\n      if (!disabled) {\n        // get the children data for the tooltip\n        var childrenData = [];\n        var totalValue = [];\n        var parentValue = null;\n\n        if (datum.children) {\n          if (datum.depth > 1 && canvasZoomEnabled) {\n            zoomable = true;\n            hoveredElement.classed('clickable', true);\n          }\n\n          childrenData = datum.children.map(function (child) {\n            if (child !== null) {\n              // sum up the children values if there are any 3rd level\n              var value = void 0;\n\n              if (typeof child.data.value === 'number') {\n                value = child.data.value;\n                return {\n                  label: child.data.name,\n                  value: value\n                };\n              } else {\n                value = child.data.children.reduce(function (a, b) {\n                  return a + b.value;\n                }, 0);\n                return {\n                  label: child.data.name,\n                  labelIcon: canvasZoomEnabled && hierarchyLevel <= 2 ? self.getZoomIcon() : null,\n                  value: value\n                };\n              }\n            }\n          });\n          totalValue = [{\n            label: 'Total',\n            value: datum.value,\n            bold: true\n          }]; // children get a highlight stroke\n\n          self.highlightChildren(datum.children);\n        } else {\n          // if there is no children we want to display the value for the data\n          parentValue = datum.value;\n        }\n\n        var fillColor = getComputedStyle(this, null).getPropertyValue('fill'); // Show tooltip\n\n        self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n          hoveredElement: hoveredElement,\n          items: __spreadArrays([{\n            color: fillColor,\n            label: datum.data.name,\n            labelIcon: zoomable && canvasZoomEnabled && hierarchyLevel <= 2 ? self.getZoomIcon() : null,\n            value: parentValue\n          }], childrenData, totalValue)\n        });\n      } // Dispatch mouse event\n\n\n      self.services.events.dispatchEvent(Events.CirclePack.CIRCLE_MOUSEOVER, {\n        element: hoveredElement,\n        datum: datum\n      });\n    }).on('mousemove', function (datum) {\n      var hoveredElement = select(this); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.CirclePack.CIRCLE_MOUSEMOVE, {\n        element: hoveredElement,\n        datum: datum\n      });\n      self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n    }).on('mouseout', function (datum) {\n      var hoveredElement = select(this);\n      hoveredElement.classed('hovered', false);\n\n      if (datum.children) {\n        self.unhighlightChildren(datum.children);\n      } // Dispatch mouse event\n\n\n      self.services.events.dispatchEvent(Events.CirclePack.CIRCLE_MOUSEOUT, {\n        element: hoveredElement,\n        datum: datum\n      }); // Hide tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n        hoveredElement: hoveredElement\n      });\n    }).on('click', function (datum) {\n      var hoveredElement = select(this);\n      var disabled = hoveredElement.classed('non-focal');\n      var zoomedIn = Tools.getProperty(self.getOptions(), 'canvasZoom', 'enabled') && self.model.getHierarchyLevel() > 2;\n\n      if (zoomedIn) {\n        var canvasSelection = self.parent.selectAll('circle.node');\n        var chartSvg = select(self.services.domUtils.getMainSVG());\n        chartSvg.classed('zoomed-in', false);\n        self.focal = null;\n        self.model.updateHierarchyLevel(2);\n        self.services.canvasZoom.zoomOut(canvasSelection, Configuration.canvasZoomSettings);\n      } // zoom if chart has zoom enabled and if its a depth 2 circle that has children\n      else if (datum.depth === 2 && datum.children && !disabled) {\n          var canvasSelection = self.parent.selectAll('circle.node');\n          var chartSvg = select(self.services.domUtils.getMainSVG());\n          chartSvg.classed('zoomed-in', true);\n          self.focal = datum;\n          self.model.updateHierarchyLevel(3);\n          self.services.canvasZoom.zoomIn(datum, canvasSelection, Configuration.canvasZoomSettings); // don't want the click event to propagate to the background zoom out\n          // does not clash with the tooltip/other events because it does need to close the\n          // tooltip on the click event in order to zoom in/out\n\n          event.stopPropagation();\n        } // Dispatch mouse event\n\n\n      self.services.events.dispatchEvent(Events.CirclePack.CIRCLE_CLICK, {\n        element: hoveredElement,\n        datum: datum\n      });\n    });\n  };\n\n  CirclePack.prototype.destroy = function () {\n    // Remove event listeners\n    this.parent.selectAll('circle.node').on('mouseover', null).on('mousemove', null).on('mouseout', null).on('click', null); // remove the listeners on the legend\n\n    var eventsFragment = this.services.events;\n    eventsFragment.removeEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover);\n    eventsFragment.removeEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n    this.removeBackgroundListeners();\n  };\n\n  return CirclePack;\n}(Component);\n\nexport { CirclePack };","map":{"version":3,"sources":["/Users/zander/Documents/Development/ActionsLogging/Dashboard/node_modules/@carbon/charts/components/graphs/circle-pack.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__spreadArrays","s","i","il","arguments","length","r","k","a","j","jl","Component","DOMUtils","Configuration","hierarchy","d3Hierarchy","pack","D3Pack","event","select","ColorClassNameTypes","Events","Tools","CirclePack","_super","_this","apply","type","handleLegendOnHover","hoveredElement","detail","parent","selectAll","transition","services","transitions","getTransition","attr","data","dataGroupName","datum","circlePack","circles","fillOpacity","handleLegendMouseOut","render","animate","svg","getContainerSVG","withinChartClip","_a","getSVGElementSize","useAttrs","width","height","displayData","model","getDisplayData","parentNode","hasParentNode","hierarchyLevel","getHierarchyLevel","options","getOptions","canvasZoomEnabled","getProperty","root","children","sum","value","sort","packLayout","size","padding","depth","mainGroup","nodeData","descendants","splice","filter","node","exit","remove","enteringCircles","enter","append","classed","merge","originalClass","getZoomClass","getColorClassName","classNameTypes","FILL","STROKE","originalClassName","x","y","focal","canvasZoom","zoomIn","canvasZoomSettings","setBackgroundListeners","addLegendListeners","addEventListeners","unhighlightChildren","childData","map","some","highlightChildren","classname","events","addEventListener","Legend","ITEM_HOVER","ITEM_MOUSEOUT","removeBackgroundListeners","chartSvg","domUtils","getMainSVG","on","self","canvasSelection","zoomSetting","updateHierarchyLevel","zoomOut","getZoomIcon","disabled","zoomable","childrenData","totalValue","parentValue","child","label","name","reduce","labelIcon","bold","fillColor","getComputedStyle","getPropertyValue","dispatchEvent","Tooltip","SHOW","items","color","CIRCLE_MOUSEOVER","element","CIRCLE_MOUSEMOVE","MOVE","CIRCLE_MOUSEOUT","HIDE","zoomedIn","stopPropagation","CIRCLE_CLICK","destroy","eventsFragment","removeEventListener"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\n// Internal Imports\nimport { Component } from '../component';\nimport { DOMUtils } from '../../services';\nimport * as Configuration from '../../configuration';\n// D3 Imports\nimport { hierarchy as d3Hierarchy, pack as D3Pack } from 'd3-hierarchy';\nimport { event, select } from 'd3-selection';\nimport { ColorClassNameTypes, Events } from '../../interfaces/enums';\nimport { Tools } from './../../tools';\nvar CirclePack = /** @class */ (function (_super) {\n    __extends(CirclePack, _super);\n    function CirclePack() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.type = 'circle-pack';\n        _this.handleLegendOnHover = function (event) {\n            var hoveredElement = event.detail.hoveredElement;\n            _this.parent\n                .selectAll('circle.node')\n                .transition(_this.services.transitions.getTransition('legend-hover-circlepack'))\n                .attr('opacity', function (d) {\n                return d.data.dataGroupName === hoveredElement.datum()['name']\n                    ? 1\n                    : Configuration.circlePack.circles.fillOpacity;\n            });\n        };\n        _this.handleLegendMouseOut = function (event) {\n            _this.parent\n                .selectAll('circle.node')\n                .transition(_this.services.transitions.getTransition('legend-mouseout-circlepack'))\n                .attr('opacity', 1);\n        };\n        return _this;\n    }\n    CirclePack.prototype.render = function (animate) {\n        var _this = this;\n        if (animate === void 0) { animate = true; }\n        // svg and container widths\n        var svg = this.getContainerSVG({ withinChartClip: true });\n        var _a = DOMUtils.getSVGElementSize(this.parent, {\n            useAttrs: true,\n        }), width = _a.width, height = _a.height;\n        if (width === 0 || height === 0) {\n            // on first render the svg is width and height 0\n            // the circle packing layout functionality will not run\n            return;\n        }\n        // data and options (zoom/not zoom)\n        var displayData = this.model.getDisplayData();\n        // check if there is just one parent for the data\n        var parentNode = this.model.hasParentNode();\n        var hierarchyLevel = this.model.getHierarchyLevel();\n        var options = this.getOptions();\n        var canvasZoomEnabled = Tools.getProperty(options, 'canvasZoom', 'enabled');\n        // check if there is one root for the data\n        // that root will be the only datagroup (colorscale will be monochrome)\n        if (parentNode && Tools.getProperty(displayData, 0, 'children')) {\n            // remove want to remove the parent from being rendered\n            displayData = Tools.getProperty(displayData, 0, 'children');\n        }\n        var root = d3Hierarchy({ children: displayData })\n            .sum(function (d) { return d.value; })\n            .sort(function (a, b) { return b.value - a.value; });\n        var packLayout = D3Pack()\n            .size([width, height])\n            .padding(function (d) {\n            // add 3 px to account for the stroke width 1.5px\n            return d.depth >= 1\n                ? Configuration.circlePack.padding.children + 3\n                : Configuration.circlePack.padding.mainGroup + 3;\n        });\n        var nodeData = packLayout(root)\n            .descendants()\n            .splice(1)\n            .filter(function (node) {\n            // filter based on hierarchy level\n            return node.depth <= hierarchyLevel;\n        });\n        // enter the circles\n        var circles = svg.selectAll('circle.node').data(nodeData);\n        circles.exit().attr('width', 0).attr('height', 0).remove();\n        var enteringCircles = circles\n            .enter()\n            .append('circle')\n            .classed('node', true);\n        enteringCircles\n            .merge(circles)\n            .attr('class', function (d) {\n            var originalClass = canvasZoomEnabled && hierarchyLevel === 3\n                ? _this.getZoomClass(d)\n                : '';\n            return _this.model.getColorClassName({\n                classNameTypes: [\n                    ColorClassNameTypes.FILL,\n                    ColorClassNameTypes.STROKE,\n                ],\n                dataGroupName: d.data.dataGroupName,\n                originalClassName: d.children\n                    ? \"node \" + originalClass\n                    : \"node node-leaf \" + originalClass,\n            });\n        })\n            .attr('cx', function (d) { return d.x; })\n            .attr('cy', function (d) { return d.y; })\n            .transition(this.services.transitions.getTransition('circlepack-leaf-update-enter', animate))\n            .attr('r', function (d) { return d.r; })\n            .attr('opacity', 1)\n            .attr('fill-opacity', Configuration.circlePack.circles.fillOpacity);\n        if (canvasZoomEnabled === true && this.focal) {\n            this.services.canvasZoom.zoomIn(this.focal, enteringCircles, Configuration.canvasZoomSettings);\n            this.setBackgroundListeners();\n        }\n        if (!parentNode) {\n            // add legend filtering if it isnt a monochrome chart\n            this.addLegendListeners();\n        }\n        // Add event listeners to elements drawn\n        this.addEventListeners();\n    };\n    // turn off the highlight class on children circles\n    CirclePack.prototype.unhighlightChildren = function (childData) {\n        var data = childData.map(function (d) { return d.data; });\n        this.parent\n            .selectAll('circle.node')\n            .filter(function (d) { return data.some(function (datum) { return datum === d.data; }) && d.depth > 1; })\n            .classed('hovered-child', false);\n    };\n    // highlight the children circles with a stroke\n    CirclePack.prototype.highlightChildren = function (childData, classname) {\n        var data = childData.map(function (d) { return d.data; });\n        this.parent\n            .selectAll('circle.node')\n            .filter(function (d) { return data.some(function (datum) { return datum === d.data; }) && d.depth > 1; })\n            .classed(classname ? classname : 'hovered-child', true);\n    };\n    CirclePack.prototype.getZoomClass = function (node) {\n        if (this.model.getHierarchyLevel() === 3 && this.focal) {\n            if (node.data === this.focal.data ||\n                this.focal.children.some(function (d) { return d.data === node.data; })) {\n                return 'focal';\n            }\n        }\n        return 'non-focal';\n    };\n    CirclePack.prototype.addLegendListeners = function () {\n        var events = this.services.events;\n        // Highlight correct circle on legend item hovers\n        events.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover);\n        // Un-highlight circles on legend item mouseouts\n        events.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n    };\n    CirclePack.prototype.removeBackgroundListeners = function () {\n        var chartSvg = select(this.services.domUtils.getMainSVG());\n        chartSvg.on('click', function () { return null; });\n    };\n    CirclePack.prototype.setBackgroundListeners = function () {\n        var chartSvg = select(this.services.domUtils.getMainSVG());\n        var self = this;\n        var canvasSelection = this.parent.selectAll('circle.node');\n        var zoomSetting = Tools.getProperty(Configuration, 'canvasZoomSettings');\n        chartSvg.on('click', function () {\n            self.focal = null;\n            self.model.updateHierarchyLevel(2);\n            chartSvg.classed('zoomed-in', false);\n            self.services.canvasZoom.zoomOut(canvasSelection, zoomSetting);\n        });\n    };\n    // Zoom icon to be appended to the label in the tooltip\n    CirclePack.prototype.getZoomIcon = function () {\n        return \"\\n\\t\\t<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 10 10\\\">\\n\\t\\t\\t<polygon points=\\\"5.93 3.71 4.45 3.71 4.45 2.23 3.71 2.23 3.71 3.71 2.23 3.71 2.23 4.45 3.71 4.45 3.71 5.93 4.45 5.93 4.45 4.45 5.93 4.45 5.93 3.71\\\"/>\\n\\t\\t\\t<path d=\\\"M7.2,6.67a4,4,0,0,0,1-2.59A4.08,4.08,0,1,0,4.07,8.15h0a4,4,0,0,0,2.59-1L9.48,10,10,9.48Zm-3.12.77A3.34,3.34,0,1,1,7.41,4.08,3.34,3.34,0,0,1,4.08,7.44Z\\\"/>\\n\\t\\t</svg>\";\n    };\n    // add event listeners for tooltip on the circles\n    CirclePack.prototype.addEventListeners = function () {\n        var self = this;\n        this.parent\n            .selectAll('circle.node')\n            .on('mouseover', function (datum) {\n            var hoveredElement = select(this);\n            hoveredElement.classed('hovered', true);\n            var hierarchyLevel = self.model.getHierarchyLevel();\n            var disabled = hierarchyLevel > 2 && !hoveredElement.classed('focal');\n            var canvasZoomEnabled = Tools.getProperty(self.model.getOptions(), 'canvasZoom', 'enabled');\n            var zoomable = false;\n            if (!disabled) {\n                // get the children data for the tooltip\n                var childrenData = [];\n                var totalValue = [];\n                var parentValue = null;\n                if (datum.children) {\n                    if (datum.depth > 1 && canvasZoomEnabled) {\n                        zoomable = true;\n                        hoveredElement.classed('clickable', true);\n                    }\n                    childrenData = datum.children.map(function (child) {\n                        if (child !== null) {\n                            // sum up the children values if there are any 3rd level\n                            var value = void 0;\n                            if (typeof child.data.value === 'number') {\n                                value = child.data.value;\n                                return {\n                                    label: child.data.name,\n                                    value: value,\n                                };\n                            }\n                            else {\n                                value = child.data.children.reduce(function (a, b) { return a + b.value; }, 0);\n                                return {\n                                    label: child.data.name,\n                                    labelIcon: canvasZoomEnabled &&\n                                        hierarchyLevel <= 2\n                                        ? self.getZoomIcon()\n                                        : null,\n                                    value: value,\n                                };\n                            }\n                        }\n                    });\n                    totalValue = [\n                        {\n                            label: 'Total',\n                            value: datum.value,\n                            bold: true,\n                        },\n                    ];\n                    // children get a highlight stroke\n                    self.highlightChildren(datum.children);\n                }\n                else {\n                    // if there is no children we want to display the value for the data\n                    parentValue = datum.value;\n                }\n                var fillColor = getComputedStyle(this, null).getPropertyValue('fill');\n                // Show tooltip\n                self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n                    hoveredElement: hoveredElement,\n                    items: __spreadArrays([\n                        {\n                            color: fillColor,\n                            label: datum.data.name,\n                            labelIcon: zoomable &&\n                                canvasZoomEnabled &&\n                                hierarchyLevel <= 2\n                                ? self.getZoomIcon()\n                                : null,\n                            value: parentValue,\n                        }\n                    ], childrenData, totalValue),\n                });\n            }\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.CirclePack.CIRCLE_MOUSEOVER, {\n                element: hoveredElement,\n                datum: datum,\n            });\n        })\n            .on('mousemove', function (datum) {\n            var hoveredElement = select(this);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.CirclePack.CIRCLE_MOUSEMOVE, {\n                element: hoveredElement,\n                datum: datum,\n            });\n            self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n        })\n            .on('mouseout', function (datum) {\n            var hoveredElement = select(this);\n            hoveredElement.classed('hovered', false);\n            if (datum.children) {\n                self.unhighlightChildren(datum.children);\n            }\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.CirclePack.CIRCLE_MOUSEOUT, {\n                element: hoveredElement,\n                datum: datum,\n            });\n            // Hide tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n                hoveredElement: hoveredElement,\n            });\n        })\n            .on('click', function (datum) {\n            var hoveredElement = select(this);\n            var disabled = hoveredElement.classed('non-focal');\n            var zoomedIn = Tools.getProperty(self.getOptions(), 'canvasZoom', 'enabled') && self.model.getHierarchyLevel() > 2;\n            if (zoomedIn) {\n                var canvasSelection = self.parent.selectAll('circle.node');\n                var chartSvg = select(self.services.domUtils.getMainSVG());\n                chartSvg.classed('zoomed-in', false);\n                self.focal = null;\n                self.model.updateHierarchyLevel(2);\n                self.services.canvasZoom.zoomOut(canvasSelection, Configuration.canvasZoomSettings);\n            }\n            // zoom if chart has zoom enabled and if its a depth 2 circle that has children\n            else if (datum.depth === 2 && datum.children && !disabled) {\n                var canvasSelection = self.parent.selectAll('circle.node');\n                var chartSvg = select(self.services.domUtils.getMainSVG());\n                chartSvg.classed('zoomed-in', true);\n                self.focal = datum;\n                self.model.updateHierarchyLevel(3);\n                self.services.canvasZoom.zoomIn(datum, canvasSelection, Configuration.canvasZoomSettings);\n                // don't want the click event to propagate to the background zoom out\n                // does not clash with the tooltip/other events because it does need to close the\n                // tooltip on the click event in order to zoom in/out\n                event.stopPropagation();\n            }\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.CirclePack.CIRCLE_CLICK, {\n                element: hoveredElement,\n                datum: datum,\n            });\n        });\n    };\n    CirclePack.prototype.destroy = function () {\n        // Remove event listeners\n        this.parent\n            .selectAll('circle.node')\n            .on('mouseover', null)\n            .on('mousemove', null)\n            .on('mouseout', null)\n            .on('click', null);\n        // remove the listeners on the legend\n        var eventsFragment = this.services.events;\n        eventsFragment.removeEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover);\n        eventsFragment.removeEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n        this.removeBackgroundListeners();\n    };\n    return CirclePack;\n}(Component));\nexport { CirclePack };\n//# sourceMappingURL=../../../src/components/graphs/circle-pack.js.map"]},"metadata":{},"sourceType":"module"}