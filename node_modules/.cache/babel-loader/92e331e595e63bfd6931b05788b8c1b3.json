{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // Internal Imports\n\n\nimport { Component } from '../component';\nimport { Roles, Events, ColorClassNameTypes } from '../../interfaces';\nimport { Tools } from '../../tools'; // D3 Imports\n\nimport { select } from 'd3-selection';\n\nvar Scatter =\n/** @class */\nfunction (_super) {\n  __extends(Scatter, _super);\n\n  function Scatter() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = 'scatter';\n\n    _this.handleChartHolderOnHover = function (event) {\n      _this.parent.selectAll('circle.dot').transition(_this.services.transitions.getTransition('chart-holder-hover-scatter')).attr('opacity', 1);\n    };\n\n    _this.handleChartHolderOnMouseOut = function (event) {\n      _this.parent.selectAll('circle.dot').transition(_this.services.transitions.getTransition('chart-holder-mouseout-scatter')).attr('opacity', 0);\n    };\n\n    _this.handleLegendOnHover = function (event) {\n      var hoveredElement = event.detail.hoveredElement;\n\n      var groupMapsTo = _this.getOptions().data.groupMapsTo;\n\n      _this.parent.selectAll('circle.dot').transition(_this.services.transitions.getTransition('legend-hover-scatter')).attr('opacity', function (d) {\n        return d[groupMapsTo] !== hoveredElement.datum()['name'] ? 0.3 : 1;\n      });\n    };\n\n    _this.handleLegendMouseOut = function (event) {\n      _this.parent.selectAll('circle.dot').transition(_this.services.transitions.getTransition('legend-mouseout-scatter')).attr('opacity', 1);\n    };\n\n    return _this;\n  }\n\n  Scatter.prototype.init = function () {\n    var events = this.services.events; // Highlight correct circle on legend item hovers\n\n    events.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover); // Un-highlight circles on legend item mouseouts\n\n    events.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n    var fadeInOnChartHolderMouseover = this.configs.fadeInOnChartHolderMouseover;\n\n    if (fadeInOnChartHolderMouseover) {\n      // Fade-in scatter circles\n      events.addEventListener(Events.Chart.MOUSEOVER, this.handleChartHolderOnHover); // Fade-out scatter circles\n\n      events.addEventListener(Events.Chart.MOUSEOUT, this.handleChartHolderOnMouseOut);\n    }\n  };\n\n  Scatter.prototype.filterBasedOnZoomDomain = function (data) {\n    var domainIdentifier = this.services.cartesianScales.getDomainIdentifier(data);\n    var zoomDomain = this.model.get('zoomDomain');\n\n    if (zoomDomain !== undefined) {\n      return data.filter(function (d) {\n        return d[domainIdentifier].getTime() > zoomDomain[0].getTime() && d[domainIdentifier].getTime() < zoomDomain[1].getTime();\n      });\n    }\n\n    return data;\n  };\n\n  Scatter.prototype.getScatterData = function () {\n    var _this = this;\n\n    var options = this.getOptions();\n    var stacked = this.configs.stacked;\n    var scatterData;\n\n    if (stacked) {\n      var percentage = Object.keys(options.axes).some(function (axis) {\n        return options.axes[axis].percentage;\n      });\n      scatterData = this.model.getStackedData({\n        groups: this.configs.groups,\n        percentage: percentage\n      });\n    } else {\n      scatterData = this.model.getDisplayData(this.configs.groups).filter(function (d) {\n        var rangeIdentifier = _this.services.cartesianScales.getRangeIdentifier(d);\n\n        return d[rangeIdentifier] !== undefined && d[rangeIdentifier] !== null;\n      });\n    } // filter out datapoints that aren't part of the zoomed domain\n\n\n    return this.filterBasedOnZoomDomain(scatterData);\n  };\n\n  Scatter.prototype.render = function (animate) {\n    var isScatterEnabled = Tools.getProperty(this.getOptions(), 'points', 'enabled') || Tools.getProperty(this.getOptions(), 'bubble', 'enabled');\n\n    if (!isScatterEnabled) {\n      return;\n    } // Grab container SVG\n\n\n    var svg = this.getContainerSVG({\n      withinChartClip: true\n    });\n    var options = this.getOptions();\n    var groupMapsTo = options.data.groupMapsTo;\n    var domainIdentifier = this.services.cartesianScales.getDomainIdentifier(); // Update data on dot groups\n\n    var circles = svg.selectAll('circle.dot').data(this.getScatterData(), function (datum) {\n      return datum[groupMapsTo] + \"-\" + datum[domainIdentifier];\n    }); // Remove circles that need to be removed\n\n    circles.exit().attr('opacity', 0).remove(); // Add the dot groups that need to be introduced\n\n    var enteringCircles = circles.enter().append('circle').classed('dot', true).attr('opacity', 0); // Apply styling & position\n\n    var circlesToStyle = enteringCircles.merge(circles);\n    this.styleCircles(circlesToStyle, animate); // Add event listeners to elements drawn\n\n    this.addEventListeners();\n  }; // A value is an anomaly if is above all defined domain and range thresholds\n\n\n  Scatter.prototype.isDatapointThresholdAnomaly = function (datum, index) {\n    var _this = this;\n\n    var handleThresholds = this.configs.handleThresholds;\n\n    if (!handleThresholds) {\n      return false;\n    }\n\n    var cartesianScales = this.services.cartesianScales;\n    var orientation = cartesianScales.getOrientation(); // Get highest domain and range thresholds\n\n    var _a = Tools.flipDomainAndRangeBasedOnOrientation(this.services.cartesianScales.getHighestDomainThreshold(), this.services.cartesianScales.getHighestRangeThreshold(), orientation),\n        xThreshold = _a[0],\n        yThreshold = _a[1];\n\n    var _b = Tools.flipDomainAndRangeBasedOnOrientation(function (d, i) {\n      return _this.services.cartesianScales.getDomainValue(d, i);\n    }, function (d, i) {\n      return _this.services.cartesianScales.getRangeValue(d, i);\n    }, orientation),\n        getXValue = _b[0],\n        getYValue = _b[1]; // Get datum x and y values\n\n\n    var xValue = getXValue(datum, index);\n    var yValue = getYValue(datum, index); // To be an anomaly, the value has to be higher or equal than the threshold value\n    // (if are present, both range and domain threshold values)\n\n    if (yThreshold && xThreshold) {\n      return yValue <= yThreshold.scaleValue && xValue >= xThreshold.scaleValue;\n    }\n\n    if (yThreshold) {\n      return yValue <= yThreshold.scaleValue;\n    }\n\n    if (xThreshold) {\n      return xValue >= xThreshold.scaleValue;\n    }\n  };\n\n  Scatter.prototype.styleCircles = function (selection, animate) {\n    var _this = this; // Chart options mixed with the internal configurations\n\n\n    var options = this.getOptions();\n    var _a = options.points,\n        filled = _a.filled,\n        fillOpacity = _a.fillOpacity;\n    var _b = this.services,\n        cartesianScales = _b.cartesianScales,\n        transitions = _b.transitions;\n    var groupMapsTo = options.data.groupMapsTo;\n\n    var getDomainValue = function getDomainValue(d, i) {\n      return cartesianScales.getDomainValue(d, i);\n    };\n\n    var getRangeValue = function getRangeValue(d, i) {\n      return cartesianScales.getRangeValue(d, i);\n    };\n\n    var _c = Tools.flipDomainAndRangeBasedOnOrientation(getDomainValue, getRangeValue, cartesianScales.getOrientation()),\n        getXValue = _c[0],\n        getYValue = _c[1];\n\n    var fadeInOnChartHolderMouseover = this.configs.fadeInOnChartHolderMouseover;\n    selection.raise().classed('dot', true).attr('class', function (d) {\n      var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n\n      var isFilled = _this.model.getIsFilled(d[groupMapsTo], d[domainIdentifier], d, filled);\n\n      var classNamesNeeded = isFilled ? [ColorClassNameTypes.FILL, ColorClassNameTypes.STROKE] : [ColorClassNameTypes.STROKE];\n      return _this.model.getColorClassName({\n        classNameTypes: classNamesNeeded,\n        dataGroupName: d[groupMapsTo],\n        originalClassName: 'dot'\n      });\n    }) // Set class to highlight the dots that are above all the thresholds, in both directions (vertical and horizontal)\n    .classed('threshold-anomaly', function (d, i) {\n      return _this.isDatapointThresholdAnomaly(d, i);\n    }).classed('filled', function (d) {\n      var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n      return _this.model.getIsFilled(d[groupMapsTo], d[domainIdentifier], d, filled);\n    }).classed('unfilled', function (d) {\n      var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n      return !_this.model.getIsFilled(d[groupMapsTo], d[domainIdentifier], d, filled);\n    }).transition(transitions.getTransition('scatter-update-enter', animate)).attr('cx', getXValue).attr('cy', getYValue).attr('r', options.points.radius).style('fill', function (d) {\n      var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n\n      if (_this.model.getIsFilled(d[groupMapsTo], d[domainIdentifier], d, filled)) {\n        return _this.model.getFillColor(d[groupMapsTo], d[domainIdentifier], d);\n      }\n    }).style('stroke', function (d) {\n      var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n      return _this.model.getStrokeColor(d[groupMapsTo], d[domainIdentifier], d);\n    }).attr('fill-opacity', filled ? fillOpacity : 1).attr('opacity', fadeInOnChartHolderMouseover ? 0 : 1) // a11y\n    .attr('role', Roles.GRAPHICS_SYMBOL).attr('aria-roledescription', 'point').attr('aria-label', function (d) {\n      var rangeIdentifier = cartesianScales.getRangeIdentifier(d);\n      return d[rangeIdentifier];\n    }); // Add event listeners to elements drawn\n\n    this.addEventListeners();\n  };\n\n  Scatter.prototype.addEventListeners = function () {\n    var self = this;\n    var groupMapsTo = self.getOptions().data.groupMapsTo;\n    this.parent.selectAll('circle').on('mouseover', function (datum) {\n      var hoveredElement = select(this);\n      hoveredElement.classed('hovered', true).attr('class', function (d) {\n        return self.model.getColorClassName({\n          classNameTypes: [ColorClassNameTypes.FILL],\n          dataGroupName: d[groupMapsTo],\n          originalClassName: hoveredElement.attr('class')\n        });\n      }).style('fill', function (d) {\n        var domainIdentifier = self.services.cartesianScales.getDomainIdentifier(d);\n        return self.model.getFillColor(d[groupMapsTo], d[domainIdentifier], d);\n      }).classed('unfilled', false); // Show tooltip\n\n      var bubbleOptions = Tools.getProperty(self.getOptions(), 'bubble');\n      self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n        hoveredElement: hoveredElement,\n        data: [datum],\n        additionalItems: [{\n          label: Tools.getProperty(bubbleOptions, 'radiusLabel'),\n          value: datum[Tools.getProperty(bubbleOptions, 'radiusMapsTo')]\n        }]\n      }); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.Scatter.SCATTER_MOUSEOVER, {\n        element: hoveredElement,\n        datum: datum\n      });\n    }).on('mousemove', function (datum) {\n      var hoveredElement = select(this); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.Scatter.SCATTER_MOUSEMOVE, {\n        element: hoveredElement,\n        datum: datum\n      });\n      self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n    }).on('click', function (datum) {\n      // Dispatch mouse event\n      self.services.events.dispatchEvent(Events.Scatter.SCATTER_CLICK, {\n        element: select(this),\n        datum: datum\n      });\n    }).on('mouseout', function (datum) {\n      var hoveredElement = select(this);\n      hoveredElement.classed('hovered', false);\n\n      if (!self.configs.filled) {\n        var filled_1 = self.getOptions().points.filled;\n        var domainIdentifier_1 = self.services.cartesianScales.getDomainIdentifier(datum);\n        hoveredElement.classed('unfilled', !self.model.getIsFilled(datum[groupMapsTo], datum[domainIdentifier_1], datum, filled_1)).style('fill', function (d) {\n          return filled_1 ? self.model.getFillColor(d[groupMapsTo], d[domainIdentifier_1], d) : null;\n        });\n      } // Dispatch mouse event\n\n\n      self.services.events.dispatchEvent(Events.Scatter.SCATTER_MOUSEOUT, {\n        element: hoveredElement,\n        datum: datum\n      }); // Hide tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n        hoveredElement: hoveredElement\n      });\n    });\n  };\n\n  Scatter.prototype.destroy = function () {\n    // Remove event listeners\n    this.parent.selectAll('circle').on('mousemove', null).on('mouseout', null); // Remove legend listeners\n\n    var events = this.services.events;\n    events.removeEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover);\n    events.removeEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n    events.removeEventListener(Events.Chart.MOUSEOVER, this.handleChartHolderOnHover);\n    events.removeEventListener(Events.Chart.MOUSEOUT, this.handleChartHolderOnMouseOut);\n  };\n\n  return Scatter;\n}(Component);\n\nexport { Scatter };","map":{"version":3,"sources":["/Users/zander/Documents/Development/ActionsLogging/Dashboard/node_modules/@carbon/charts/components/graphs/scatter.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Component","Roles","Events","ColorClassNameTypes","Tools","select","Scatter","_super","_this","apply","arguments","type","handleChartHolderOnHover","event","parent","selectAll","transition","services","transitions","getTransition","attr","handleChartHolderOnMouseOut","handleLegendOnHover","hoveredElement","detail","groupMapsTo","getOptions","data","datum","handleLegendMouseOut","init","events","addEventListener","Legend","ITEM_HOVER","ITEM_MOUSEOUT","fadeInOnChartHolderMouseover","configs","Chart","MOUSEOVER","MOUSEOUT","filterBasedOnZoomDomain","domainIdentifier","cartesianScales","getDomainIdentifier","zoomDomain","model","get","undefined","filter","getTime","getScatterData","options","stacked","scatterData","percentage","keys","axes","some","axis","getStackedData","groups","getDisplayData","rangeIdentifier","getRangeIdentifier","render","animate","isScatterEnabled","getProperty","svg","getContainerSVG","withinChartClip","circles","exit","remove","enteringCircles","enter","append","classed","circlesToStyle","merge","styleCircles","addEventListeners","isDatapointThresholdAnomaly","index","handleThresholds","orientation","getOrientation","_a","flipDomainAndRangeBasedOnOrientation","getHighestDomainThreshold","getHighestRangeThreshold","xThreshold","yThreshold","_b","i","getDomainValue","getRangeValue","getXValue","getYValue","xValue","yValue","scaleValue","selection","points","filled","fillOpacity","_c","raise","isFilled","getIsFilled","classNamesNeeded","FILL","STROKE","getColorClassName","classNameTypes","dataGroupName","originalClassName","radius","style","getFillColor","getStrokeColor","GRAPHICS_SYMBOL","self","on","bubbleOptions","dispatchEvent","Tooltip","SHOW","additionalItems","label","value","SCATTER_MOUSEOVER","element","SCATTER_MOUSEMOVE","MOVE","SCATTER_CLICK","filled_1","domainIdentifier_1","SCATTER_MOUSEOUT","HIDE","destroy","removeEventListener"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// Internal Imports\nimport { Component } from '../component';\nimport { Roles, Events, ColorClassNameTypes } from '../../interfaces';\nimport { Tools } from '../../tools';\n// D3 Imports\nimport { select } from 'd3-selection';\nvar Scatter = /** @class */ (function (_super) {\n    __extends(Scatter, _super);\n    function Scatter() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.type = 'scatter';\n        _this.handleChartHolderOnHover = function (event) {\n            _this.parent\n                .selectAll('circle.dot')\n                .transition(_this.services.transitions.getTransition('chart-holder-hover-scatter'))\n                .attr('opacity', 1);\n        };\n        _this.handleChartHolderOnMouseOut = function (event) {\n            _this.parent\n                .selectAll('circle.dot')\n                .transition(_this.services.transitions.getTransition('chart-holder-mouseout-scatter'))\n                .attr('opacity', 0);\n        };\n        _this.handleLegendOnHover = function (event) {\n            var hoveredElement = event.detail.hoveredElement;\n            var groupMapsTo = _this.getOptions().data.groupMapsTo;\n            _this.parent\n                .selectAll('circle.dot')\n                .transition(_this.services.transitions.getTransition('legend-hover-scatter'))\n                .attr('opacity', function (d) {\n                return d[groupMapsTo] !== hoveredElement.datum()['name'] ? 0.3 : 1;\n            });\n        };\n        _this.handleLegendMouseOut = function (event) {\n            _this.parent\n                .selectAll('circle.dot')\n                .transition(_this.services.transitions.getTransition('legend-mouseout-scatter'))\n                .attr('opacity', 1);\n        };\n        return _this;\n    }\n    Scatter.prototype.init = function () {\n        var events = this.services.events;\n        // Highlight correct circle on legend item hovers\n        events.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover);\n        // Un-highlight circles on legend item mouseouts\n        events.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n        var fadeInOnChartHolderMouseover = this.configs.fadeInOnChartHolderMouseover;\n        if (fadeInOnChartHolderMouseover) {\n            // Fade-in scatter circles\n            events.addEventListener(Events.Chart.MOUSEOVER, this.handleChartHolderOnHover);\n            // Fade-out scatter circles\n            events.addEventListener(Events.Chart.MOUSEOUT, this.handleChartHolderOnMouseOut);\n        }\n    };\n    Scatter.prototype.filterBasedOnZoomDomain = function (data) {\n        var domainIdentifier = this.services.cartesianScales.getDomainIdentifier(data);\n        var zoomDomain = this.model.get('zoomDomain');\n        if (zoomDomain !== undefined) {\n            return data.filter(function (d) {\n                return d[domainIdentifier].getTime() > zoomDomain[0].getTime() &&\n                    d[domainIdentifier].getTime() < zoomDomain[1].getTime();\n            });\n        }\n        return data;\n    };\n    Scatter.prototype.getScatterData = function () {\n        var _this = this;\n        var options = this.getOptions();\n        var stacked = this.configs.stacked;\n        var scatterData;\n        if (stacked) {\n            var percentage = Object.keys(options.axes).some(function (axis) { return options.axes[axis].percentage; });\n            scatterData = this.model.getStackedData({\n                groups: this.configs.groups,\n                percentage: percentage,\n            });\n        }\n        else {\n            scatterData = this.model\n                .getDisplayData(this.configs.groups)\n                .filter(function (d) {\n                var rangeIdentifier = _this.services.cartesianScales.getRangeIdentifier(d);\n                return (d[rangeIdentifier] !== undefined &&\n                    d[rangeIdentifier] !== null);\n            });\n        }\n        // filter out datapoints that aren't part of the zoomed domain\n        return this.filterBasedOnZoomDomain(scatterData);\n    };\n    Scatter.prototype.render = function (animate) {\n        var isScatterEnabled = Tools.getProperty(this.getOptions(), 'points', 'enabled') ||\n            Tools.getProperty(this.getOptions(), 'bubble', 'enabled');\n        if (!isScatterEnabled) {\n            return;\n        }\n        // Grab container SVG\n        var svg = this.getContainerSVG({ withinChartClip: true });\n        var options = this.getOptions();\n        var groupMapsTo = options.data.groupMapsTo;\n        var domainIdentifier = this.services.cartesianScales.getDomainIdentifier();\n        // Update data on dot groups\n        var circles = svg\n            .selectAll('circle.dot')\n            .data(this.getScatterData(), function (datum) { return datum[groupMapsTo] + \"-\" + datum[domainIdentifier]; });\n        // Remove circles that need to be removed\n        circles.exit().attr('opacity', 0).remove();\n        // Add the dot groups that need to be introduced\n        var enteringCircles = circles\n            .enter()\n            .append('circle')\n            .classed('dot', true)\n            .attr('opacity', 0);\n        // Apply styling & position\n        var circlesToStyle = enteringCircles.merge(circles);\n        this.styleCircles(circlesToStyle, animate);\n        // Add event listeners to elements drawn\n        this.addEventListeners();\n    };\n    // A value is an anomaly if is above all defined domain and range thresholds\n    Scatter.prototype.isDatapointThresholdAnomaly = function (datum, index) {\n        var _this = this;\n        var handleThresholds = this.configs.handleThresholds;\n        if (!handleThresholds) {\n            return false;\n        }\n        var cartesianScales = this.services.cartesianScales;\n        var orientation = cartesianScales.getOrientation();\n        // Get highest domain and range thresholds\n        var _a = Tools.flipDomainAndRangeBasedOnOrientation(this.services.cartesianScales.getHighestDomainThreshold(), this.services.cartesianScales.getHighestRangeThreshold(), orientation), xThreshold = _a[0], yThreshold = _a[1];\n        var _b = Tools.flipDomainAndRangeBasedOnOrientation(function (d, i) { return _this.services.cartesianScales.getDomainValue(d, i); }, function (d, i) { return _this.services.cartesianScales.getRangeValue(d, i); }, orientation), getXValue = _b[0], getYValue = _b[1];\n        // Get datum x and y values\n        var xValue = getXValue(datum, index);\n        var yValue = getYValue(datum, index);\n        // To be an anomaly, the value has to be higher or equal than the threshold value\n        // (if are present, both range and domain threshold values)\n        if (yThreshold && xThreshold) {\n            return (yValue <= yThreshold.scaleValue &&\n                xValue >= xThreshold.scaleValue);\n        }\n        if (yThreshold) {\n            return yValue <= yThreshold.scaleValue;\n        }\n        if (xThreshold) {\n            return xValue >= xThreshold.scaleValue;\n        }\n    };\n    Scatter.prototype.styleCircles = function (selection, animate) {\n        var _this = this;\n        // Chart options mixed with the internal configurations\n        var options = this.getOptions();\n        var _a = options.points, filled = _a.filled, fillOpacity = _a.fillOpacity;\n        var _b = this.services, cartesianScales = _b.cartesianScales, transitions = _b.transitions;\n        var groupMapsTo = options.data.groupMapsTo;\n        var getDomainValue = function (d, i) { return cartesianScales.getDomainValue(d, i); };\n        var getRangeValue = function (d, i) { return cartesianScales.getRangeValue(d, i); };\n        var _c = Tools.flipDomainAndRangeBasedOnOrientation(getDomainValue, getRangeValue, cartesianScales.getOrientation()), getXValue = _c[0], getYValue = _c[1];\n        var fadeInOnChartHolderMouseover = this.configs.fadeInOnChartHolderMouseover;\n        selection\n            .raise()\n            .classed('dot', true)\n            .attr('class', function (d) {\n            var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n            var isFilled = _this.model.getIsFilled(d[groupMapsTo], d[domainIdentifier], d, filled);\n            var classNamesNeeded = isFilled\n                ? [ColorClassNameTypes.FILL, ColorClassNameTypes.STROKE]\n                : [ColorClassNameTypes.STROKE];\n            return _this.model.getColorClassName({\n                classNameTypes: classNamesNeeded,\n                dataGroupName: d[groupMapsTo],\n                originalClassName: 'dot',\n            });\n        })\n            // Set class to highlight the dots that are above all the thresholds, in both directions (vertical and horizontal)\n            .classed('threshold-anomaly', function (d, i) {\n            return _this.isDatapointThresholdAnomaly(d, i);\n        })\n            .classed('filled', function (d) {\n            var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n            return _this.model.getIsFilled(d[groupMapsTo], d[domainIdentifier], d, filled);\n        })\n            .classed('unfilled', function (d) {\n            var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n            return !_this.model.getIsFilled(d[groupMapsTo], d[domainIdentifier], d, filled);\n        })\n            .transition(transitions.getTransition('scatter-update-enter', animate))\n            .attr('cx', getXValue)\n            .attr('cy', getYValue)\n            .attr('r', options.points.radius)\n            .style('fill', function (d) {\n            var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n            if (_this.model.getIsFilled(d[groupMapsTo], d[domainIdentifier], d, filled)) {\n                return _this.model.getFillColor(d[groupMapsTo], d[domainIdentifier], d);\n            }\n        })\n            .style('stroke', function (d) {\n            var domainIdentifier = cartesianScales.getDomainIdentifier(d);\n            return _this.model.getStrokeColor(d[groupMapsTo], d[domainIdentifier], d);\n        })\n            .attr('fill-opacity', filled ? fillOpacity : 1)\n            .attr('opacity', fadeInOnChartHolderMouseover ? 0 : 1)\n            // a11y\n            .attr('role', Roles.GRAPHICS_SYMBOL)\n            .attr('aria-roledescription', 'point')\n            .attr('aria-label', function (d) {\n            var rangeIdentifier = cartesianScales.getRangeIdentifier(d);\n            return d[rangeIdentifier];\n        });\n        // Add event listeners to elements drawn\n        this.addEventListeners();\n    };\n    Scatter.prototype.addEventListeners = function () {\n        var self = this;\n        var groupMapsTo = self.getOptions().data.groupMapsTo;\n        this.parent\n            .selectAll('circle')\n            .on('mouseover', function (datum) {\n            var hoveredElement = select(this);\n            hoveredElement\n                .classed('hovered', true)\n                .attr('class', function (d) {\n                return self.model.getColorClassName({\n                    classNameTypes: [ColorClassNameTypes.FILL],\n                    dataGroupName: d[groupMapsTo],\n                    originalClassName: hoveredElement.attr('class'),\n                });\n            })\n                .style('fill', function (d) {\n                var domainIdentifier = self.services.cartesianScales.getDomainIdentifier(d);\n                return self.model.getFillColor(d[groupMapsTo], d[domainIdentifier], d);\n            })\n                .classed('unfilled', false);\n            // Show tooltip\n            var bubbleOptions = Tools.getProperty(self.getOptions(), 'bubble');\n            self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n                hoveredElement: hoveredElement,\n                data: [datum],\n                additionalItems: [\n                    {\n                        label: Tools.getProperty(bubbleOptions, 'radiusLabel'),\n                        value: datum[Tools.getProperty(bubbleOptions, 'radiusMapsTo')],\n                    },\n                ],\n            });\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Scatter.SCATTER_MOUSEOVER, {\n                element: hoveredElement,\n                datum: datum,\n            });\n        })\n            .on('mousemove', function (datum) {\n            var hoveredElement = select(this);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Scatter.SCATTER_MOUSEMOVE, {\n                element: hoveredElement,\n                datum: datum,\n            });\n            self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n        })\n            .on('click', function (datum) {\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Scatter.SCATTER_CLICK, {\n                element: select(this),\n                datum: datum,\n            });\n        })\n            .on('mouseout', function (datum) {\n            var hoveredElement = select(this);\n            hoveredElement.classed('hovered', false);\n            if (!self.configs.filled) {\n                var filled_1 = self.getOptions().points.filled;\n                var domainIdentifier_1 = self.services.cartesianScales.getDomainIdentifier(datum);\n                hoveredElement\n                    .classed('unfilled', !self.model.getIsFilled(datum[groupMapsTo], datum[domainIdentifier_1], datum, filled_1))\n                    .style('fill', function (d) {\n                    return filled_1\n                        ? self.model.getFillColor(d[groupMapsTo], d[domainIdentifier_1], d)\n                        : null;\n                });\n            }\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Scatter.SCATTER_MOUSEOUT, {\n                element: hoveredElement,\n                datum: datum,\n            });\n            // Hide tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n                hoveredElement: hoveredElement,\n            });\n        });\n    };\n    Scatter.prototype.destroy = function () {\n        // Remove event listeners\n        this.parent\n            .selectAll('circle')\n            .on('mousemove', null)\n            .on('mouseout', null);\n        // Remove legend listeners\n        var events = this.services.events;\n        events.removeEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover);\n        events.removeEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n        events.removeEventListener(Events.Chart.MOUSEOVER, this.handleChartHolderOnHover);\n        events.removeEventListener(Events.Chart.MOUSEOUT, this.handleChartHolderOnMouseOut);\n    };\n    return Scatter;\n}(Component));\nexport { Scatter };\n//# sourceMappingURL=../../../src/components/graphs/scatter.js.map"]},"metadata":{},"sourceType":"module"}