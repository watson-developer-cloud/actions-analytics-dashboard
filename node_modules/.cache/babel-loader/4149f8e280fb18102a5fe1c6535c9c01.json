{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // Internal Imports\n\n\nimport { Component } from '../component';\nimport { DOMUtils } from '../../services';\nimport { Events, ColorClassNameTypes } from '../../interfaces';\nimport { Tools } from '../../tools'; // D3 Imports\n\nimport { select } from 'd3-selection';\nimport { scaleLinear } from 'd3-scale';\nimport { extent } from 'd3-array';\nimport cloud from 'd3-cloud';\n\nvar WordCloud =\n/** @class */\nfunction (_super) {\n  __extends(WordCloud, _super);\n\n  function WordCloud() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = 'wordcloud'; // Highlight elements that match the hovered legend item\n\n    _this.handleLegendOnHover = function (event) {\n      var hoveredElement = event.detail.hoveredElement;\n\n      var groupMapsTo = _this.getOptions().data.groupMapsTo;\n\n      _this.parent.selectAll('text.word').transition(_this.services.transitions.getTransition('legend-hover-wordcloud')).attr('opacity', function (d) {\n        return d[groupMapsTo] !== hoveredElement.datum()['name'] ? 0.3 : 1;\n      });\n    }; // Un-highlight all elements\n\n\n    _this.handleLegendMouseOut = function (event) {\n      _this.parent.selectAll('text.word').transition(_this.services.transitions.getTransition('legend-mouseout-wordcloud')).attr('opacity', 1);\n    };\n\n    return _this;\n  }\n\n  WordCloud.prototype.init = function () {\n    var eventsFragment = this.services.events; // Highlight correct words on legend item hovers\n\n    eventsFragment.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover); // Un-highlight words on legend item mouseouts\n\n    eventsFragment.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n  };\n\n  WordCloud.prototype.getFontSizeScale = function (data) {\n    var options = this.getOptions();\n    var fontSizeMapsTo = options.wordCloud.fontSizeMapsTo; // Filter out any null/undefined values\n\n    var allOccurences = data.map(function (d) {\n      return d[fontSizeMapsTo];\n    }).filter(function (size) {\n      return size;\n    });\n    var chartSize = DOMUtils.getSVGElementSize(this.services.domUtils.getMainSVG(), {\n      useAttr: true\n    }); // We need the ternary operator here in case the user\n    // doesn't provide size values in data\n\n    var sizeDataIsValid = allOccurences.length > 0;\n    var domain = sizeDataIsValid ? extent(allOccurences) : [1, 1];\n    return scaleLinear().domain(domain).range(sizeDataIsValid ? options.wordCloud.fontSizeRange(chartSize, data) : [4, 4]);\n  };\n\n  WordCloud.prototype.render = function (animate) {\n    if (animate === void 0) {\n      animate = true;\n    }\n\n    var self = this;\n    var svg = this.getContainerSVG();\n    var displayData = this.model.getDisplayData();\n    var fontSizeScale = this.getFontSizeScale(displayData);\n    var options = this.getOptions();\n    var _a = options.wordCloud,\n        fontSizeMapsTo = _a.fontSizeMapsTo,\n        wordMapsTo = _a.wordMapsTo;\n    var groupMapsTo = options.data.groupMapsTo;\n\n    var _b = DOMUtils.getSVGElementSize(this.parent, {\n      useAttrs: true\n    }),\n        width = _b.width,\n        height = _b.height;\n\n    if (width === 0 || height === 0) {\n      return;\n    }\n\n    var layout = cloud().size([width, height]).words(displayData.map(function (d) {\n      var _a;\n\n      return _a = {}, _a[groupMapsTo] = d[groupMapsTo], _a.text = d[wordMapsTo], _a.size = d[fontSizeMapsTo], _a.value = d[fontSizeMapsTo], _a;\n    })).padding(5).rotate(0).fontSize(function (d) {\n      return fontSizeScale(d.size);\n    }).on('end', draw);\n    layout.start();\n\n    function draw(words) {\n      var textGroup = DOMUtils.appendOrSelect(svg, 'g.words');\n      textGroup.attr('transform', \"translate(\" + layout.size()[0] / 2 + \", \" + layout.size()[1] / 2 + \")\");\n      var allText = textGroup.selectAll('text').data(words, function (d) {\n        return d[groupMapsTo] + \"-\" + d.text;\n      }); // Remove texts that are no longer needed\n\n      allText.exit().attr('opacity', 0).remove();\n      var enteringText = allText.enter().append('text').attr('opacity', 0);\n      enteringText.merge(allText).style('font-size', function (d) {\n        return d.size + \"px\";\n      }).text(function (d) {\n        return d.text;\n      }).attr('class', function (d) {\n        return self.model.getColorClassName({\n          classNameTypes: [ColorClassNameTypes.FILL],\n          dataGroupName: d[groupMapsTo],\n          originalClassName: \"word \" + (d.size > 32 ? 'light' : '')\n        });\n      }).style('fill', function (d) {\n        return self.model.getFillColor(d[groupMapsTo], d.text, d);\n      }).attr('text-anchor', 'middle').transition(self.services.transitions.getTransition('wordcloud-text-update-enter', animate)).attr('transform', function (d) {\n        return \"translate(\" + d.x + \", \" + d.y + \")\";\n      }).attr('opacity', 1);\n    } // Add event listeners\n\n\n    this.addEventListeners();\n  };\n\n  WordCloud.prototype.addEventListeners = function () {\n    var options = this.getOptions();\n    var groupMapsTo = options.data.groupMapsTo; // Highlights 1 word or unhighlights all\n\n    var debouncedHighlight = Tools.debounce(function (word) {\n      var allWords = self.parent.selectAll('text.word').transition(self.services.transitions.getTransition('wordcloud-word-mouse-highlight'));\n\n      if (word === null) {\n        allWords.attr('opacity', 1);\n      } else {\n        allWords.attr('opacity', function () {\n          if (word === this) {\n            return 1;\n          }\n\n          return 0.3;\n        });\n      }\n    }, 6);\n    var self = this;\n    this.parent.selectAll('text.word').on('mouseover', function (datum) {\n      var hoveredElement = this;\n      debouncedHighlight(hoveredElement); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.WordCloud.WORD_MOUSEOVER, {\n        element: select(this),\n        datum: datum\n      }); // Show tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n        hoveredElement: hoveredElement,\n        items: [{\n          label: options.tooltip.wordLabel,\n          value: datum.text\n        }, {\n          label: options.tooltip.valueLabel,\n          value: datum.value\n        }, {\n          label: options.tooltip.groupLabel,\n          value: datum[groupMapsTo],\n          class: self.model.getColorClassName({\n            classNameTypes: [ColorClassNameTypes.TOOLTIP],\n            dataGroupName: datum[groupMapsTo]\n          })\n        }]\n      });\n    }).on('mousemove', function (datum) {\n      var hoveredElement = select(this); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.WordCloud.WORD_MOUSEMOVE, {\n        element: hoveredElement,\n        datum: datum\n      }); // Show tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n    }).on('click', function (datum) {\n      // Dispatch mouse event\n      self.services.events.dispatchEvent(Events.WordCloud.WORD_CLICK, {\n        element: select(this),\n        datum: datum\n      });\n    }).on('mouseout', function (datum) {\n      var hoveredElement = select(this);\n      debouncedHighlight(null); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.WordCloud.WORD_MOUSEOUT, {\n        element: hoveredElement,\n        datum: datum\n      }); // Hide tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n        hoveredElement: hoveredElement\n      });\n    });\n  };\n\n  return WordCloud;\n}(Component);\n\nexport { WordCloud };","map":{"version":3,"sources":["/Users/zander/Documents/Development/ActionsLogging/Dashboard/node_modules/@carbon/charts/components/graphs/wordcloud.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Component","DOMUtils","Events","ColorClassNameTypes","Tools","select","scaleLinear","extent","cloud","WordCloud","_super","_this","apply","arguments","type","handleLegendOnHover","event","hoveredElement","detail","groupMapsTo","getOptions","data","parent","selectAll","transition","services","transitions","getTransition","attr","datum","handleLegendMouseOut","init","eventsFragment","events","addEventListener","Legend","ITEM_HOVER","ITEM_MOUSEOUT","getFontSizeScale","options","fontSizeMapsTo","wordCloud","allOccurences","map","filter","size","chartSize","getSVGElementSize","domUtils","getMainSVG","useAttr","sizeDataIsValid","length","domain","range","fontSizeRange","render","animate","self","svg","getContainerSVG","displayData","model","getDisplayData","fontSizeScale","_a","wordMapsTo","_b","useAttrs","width","height","layout","words","text","value","padding","rotate","fontSize","on","draw","start","textGroup","appendOrSelect","allText","exit","remove","enteringText","enter","append","merge","style","getColorClassName","classNameTypes","FILL","dataGroupName","originalClassName","getFillColor","x","y","addEventListeners","debouncedHighlight","debounce","word","allWords","dispatchEvent","WORD_MOUSEOVER","element","Tooltip","SHOW","items","label","tooltip","wordLabel","valueLabel","groupLabel","class","TOOLTIP","WORD_MOUSEMOVE","MOVE","WORD_CLICK","WORD_MOUSEOUT","HIDE"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// Internal Imports\nimport { Component } from '../component';\nimport { DOMUtils } from '../../services';\nimport { Events, ColorClassNameTypes } from '../../interfaces';\nimport { Tools } from '../../tools';\n// D3 Imports\nimport { select } from 'd3-selection';\nimport { scaleLinear } from 'd3-scale';\nimport { extent } from 'd3-array';\nimport cloud from 'd3-cloud';\nvar WordCloud = /** @class */ (function (_super) {\n    __extends(WordCloud, _super);\n    function WordCloud() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.type = 'wordcloud';\n        // Highlight elements that match the hovered legend item\n        _this.handleLegendOnHover = function (event) {\n            var hoveredElement = event.detail.hoveredElement;\n            var groupMapsTo = _this.getOptions().data.groupMapsTo;\n            _this.parent\n                .selectAll('text.word')\n                .transition(_this.services.transitions.getTransition('legend-hover-wordcloud'))\n                .attr('opacity', function (d) {\n                return d[groupMapsTo] !== hoveredElement.datum()['name'] ? 0.3 : 1;\n            });\n        };\n        // Un-highlight all elements\n        _this.handleLegendMouseOut = function (event) {\n            _this.parent\n                .selectAll('text.word')\n                .transition(_this.services.transitions.getTransition('legend-mouseout-wordcloud'))\n                .attr('opacity', 1);\n        };\n        return _this;\n    }\n    WordCloud.prototype.init = function () {\n        var eventsFragment = this.services.events;\n        // Highlight correct words on legend item hovers\n        eventsFragment.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover);\n        // Un-highlight words on legend item mouseouts\n        eventsFragment.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n    };\n    WordCloud.prototype.getFontSizeScale = function (data) {\n        var options = this.getOptions();\n        var fontSizeMapsTo = options.wordCloud.fontSizeMapsTo;\n        // Filter out any null/undefined values\n        var allOccurences = data\n            .map(function (d) { return d[fontSizeMapsTo]; })\n            .filter(function (size) { return size; });\n        var chartSize = DOMUtils.getSVGElementSize(this.services.domUtils.getMainSVG(), { useAttr: true });\n        // We need the ternary operator here in case the user\n        // doesn't provide size values in data\n        var sizeDataIsValid = allOccurences.length > 0;\n        var domain = sizeDataIsValid ? extent(allOccurences) : [1, 1];\n        return scaleLinear()\n            .domain(domain)\n            .range(sizeDataIsValid\n            ? options.wordCloud.fontSizeRange(chartSize, data)\n            : [4, 4]);\n    };\n    WordCloud.prototype.render = function (animate) {\n        if (animate === void 0) { animate = true; }\n        var self = this;\n        var svg = this.getContainerSVG();\n        var displayData = this.model.getDisplayData();\n        var fontSizeScale = this.getFontSizeScale(displayData);\n        var options = this.getOptions();\n        var _a = options.wordCloud, fontSizeMapsTo = _a.fontSizeMapsTo, wordMapsTo = _a.wordMapsTo;\n        var groupMapsTo = options.data.groupMapsTo;\n        var _b = DOMUtils.getSVGElementSize(this.parent, {\n            useAttrs: true,\n        }), width = _b.width, height = _b.height;\n        if (width === 0 || height === 0) {\n            return;\n        }\n        var layout = cloud()\n            .size([width, height])\n            .words(displayData.map(function (d) {\n            var _a;\n            return _a = {},\n                _a[groupMapsTo] = d[groupMapsTo],\n                _a.text = d[wordMapsTo],\n                _a.size = d[fontSizeMapsTo],\n                _a.value = d[fontSizeMapsTo],\n                _a;\n        }))\n            .padding(5)\n            .rotate(0)\n            .fontSize(function (d) { return fontSizeScale(d.size); })\n            .on('end', draw);\n        layout.start();\n        function draw(words) {\n            var textGroup = DOMUtils.appendOrSelect(svg, 'g.words');\n            textGroup.attr('transform', \"translate(\" + layout.size()[0] / 2 + \", \" + layout.size()[1] / 2 + \")\");\n            var allText = textGroup\n                .selectAll('text')\n                .data(words, function (d) { return d[groupMapsTo] + \"-\" + d.text; });\n            // Remove texts that are no longer needed\n            allText.exit().attr('opacity', 0).remove();\n            var enteringText = allText\n                .enter()\n                .append('text')\n                .attr('opacity', 0);\n            enteringText\n                .merge(allText)\n                .style('font-size', function (d) { return d.size + \"px\"; })\n                .text(function (d) {\n                return d.text;\n            })\n                .attr('class', function (d) {\n                return self.model.getColorClassName({\n                    classNameTypes: [ColorClassNameTypes.FILL],\n                    dataGroupName: d[groupMapsTo],\n                    originalClassName: \"word \" + (d.size > 32 ? 'light' : ''),\n                });\n            })\n                .style('fill', function (d) {\n                return self.model.getFillColor(d[groupMapsTo], d.text, d);\n            })\n                .attr('text-anchor', 'middle')\n                .transition(self.services.transitions.getTransition('wordcloud-text-update-enter', animate))\n                .attr('transform', function (d) { return \"translate(\" + d.x + \", \" + d.y + \")\"; })\n                .attr('opacity', 1);\n        }\n        // Add event listeners\n        this.addEventListeners();\n    };\n    WordCloud.prototype.addEventListeners = function () {\n        var options = this.getOptions();\n        var groupMapsTo = options.data.groupMapsTo;\n        // Highlights 1 word or unhighlights all\n        var debouncedHighlight = Tools.debounce(function (word) {\n            var allWords = self.parent\n                .selectAll('text.word')\n                .transition(self.services.transitions.getTransition('wordcloud-word-mouse-highlight'));\n            if (word === null) {\n                allWords.attr('opacity', 1);\n            }\n            else {\n                allWords.attr('opacity', function () {\n                    if (word === this) {\n                        return 1;\n                    }\n                    return 0.3;\n                });\n            }\n        }, 6);\n        var self = this;\n        this.parent\n            .selectAll('text.word')\n            .on('mouseover', function (datum) {\n            var hoveredElement = this;\n            debouncedHighlight(hoveredElement);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.WordCloud.WORD_MOUSEOVER, {\n                element: select(this),\n                datum: datum,\n            });\n            // Show tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n                hoveredElement: hoveredElement,\n                items: [\n                    {\n                        label: options.tooltip.wordLabel,\n                        value: datum.text,\n                    },\n                    {\n                        label: options.tooltip.valueLabel,\n                        value: datum.value,\n                    },\n                    {\n                        label: options.tooltip.groupLabel,\n                        value: datum[groupMapsTo],\n                        class: self.model.getColorClassName({\n                            classNameTypes: [ColorClassNameTypes.TOOLTIP],\n                            dataGroupName: datum[groupMapsTo],\n                        }),\n                    },\n                ],\n            });\n        })\n            .on('mousemove', function (datum) {\n            var hoveredElement = select(this);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.WordCloud.WORD_MOUSEMOVE, {\n                element: hoveredElement,\n                datum: datum,\n            });\n            // Show tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n        })\n            .on('click', function (datum) {\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.WordCloud.WORD_CLICK, {\n                element: select(this),\n                datum: datum,\n            });\n        })\n            .on('mouseout', function (datum) {\n            var hoveredElement = select(this);\n            debouncedHighlight(null);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.WordCloud.WORD_MOUSEOUT, {\n                element: hoveredElement,\n                datum: datum,\n            });\n            // Hide tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n                hoveredElement: hoveredElement,\n            });\n        });\n    };\n    return WordCloud;\n}(Component));\nexport { WordCloud };\n//# sourceMappingURL=../../../src/components/graphs/wordcloud.js.map"]},"metadata":{},"sourceType":"module"}